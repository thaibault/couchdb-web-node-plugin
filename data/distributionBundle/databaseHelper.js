(()=>{var e=[e=>{!function(){"use strict";function t(){return(t=r()?Reflect.construct:function(e,t,r){var o=[null];o.push.apply(o,t);var a=new(Function.bind.apply(e,o));return r&&n(a,r.prototype),a}).apply(null,arguments)}function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function o(){return o=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},o.apply(this,arguments)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var l={d:function(e,t){for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},c={};l.r(c),l.d(c,{DatabaseHelper:function(){return p},default:function(){return s}});var p=function(){function e(){}return e.authenticate=function(e,t,r,n,o,i,l,c,p){var s;void 0===t&&(t=null),void 0===r&&(r={}),void 0===n&&(n={admins:{names:[],roles:[]},members:{names:[],roles:[]}}),void 0===i&&(i="_id"),void 0===l&&(l="-type"),void 0===c&&(c="_design/"),void 0===p&&(p=!1);var u=null!==(s=e[l])&&void 0!==s?s:t&&t[l];if(!u)return!0;var m=p?"read":"write",y={properties:{},read:["_admin","readonlyadmin"],write:["_admin"]};Object.prototype.hasOwnProperty.call(e,i)&&e[i].startsWith(c)&&y.read.push("readonlymember");var d,f="Current user doesn't own any role";if(r)if("name"in r||(r.name='"unknown"'),null!=(d=r.roles)&&d.length){if(o&&u&&Object.prototype.hasOwnProperty.call(o,u)){for(var h,g,v=o[u],O=a(["read","write"]);!(h=O()).done;)y[g=h.value]=y[g].concat(v[g]||[]);y.properties=v.properties}for(var b,w,P=y[m],j=a(r.roles);!(b=j()).done;)if(w=b.value,P.includes(w))return!0;f='Current user "'+r.name+'" owns the following roles: "'+r.roles.join('", "')+'"'}else f='Current user "'+r.name+"\" doesn't own any role";throw{unauthorized:"Only users with a least on of these roles are allowed to perform requested "+m+' action: "'+[].concat(y[m]).join('", "')+'". '+f+"."}},e.validateDocumentUpdate=function(e,r,n,i,l,c,p){void 0===c&&(c={});var s=function(e,t,r){var n;void 0===t&&(t="forbidden"),void 0===r&&(r={});for(var o=((n={})[t]=e,n.message=e,n.name=t,n),a=0,i=Object.entries(r);a<i.length;a++){var l=i[a],c=l[0],p=l[1];o[c]=p}throw o},u=new Date,m=Date.UTC(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())/1e3,y=!l.dateTimeFormat.startsWith("iso"),d=l.property.name.special,f=d.id,h=d.revision,g=d.type;r&&r[g]&&!e[g]&&(e[g]=r[g]);var v="",O="",b=function(){v=Object.prototype.hasOwnProperty.call(e,f)?e[f]:"",O=Object.prototype.hasOwnProperty.call(e,h)?e[h]:""};if(b(),Object.prototype.hasOwnProperty.call(i,l.property.name.validatedDocumentsCache)&&i[l.property.name.validatedDocumentsCache].has(v+"-"+O))return i[l.property.name.validatedDocumentsCache].delete(v+"-"+O),e;["latest","upsert"].includes(O)&&(r&&Object.prototype.hasOwnProperty.call(r,h)?O=e[h]=r[h]:"latest"===O?s("Revision: No old document available to update."):delete e[h]);var w=l.updateStrategy;Object.prototype.hasOwnProperty.call(e,d.strategy)&&(w=e[d.strategy],delete e[d.strategy]);var P,j={};if("migrate"===w)for(var x=0,N=Object.entries(c);x<N.length;x++){var A=N[x],C=A[0],S=A[1];if(Object.prototype.hasOwnProperty.call(S,d.oldType)&&![null,void 0].includes(S[d.oldType]))for(var k,T,E=a([].concat(S[d.oldType]));!(k=E()).done;)T=k.value,j[T]=C}p?P=p:JSON&&Object.prototype.hasOwnProperty.call(JSON,"stringify")?P=function(e){return JSON.stringify(e,null,4)}:s('Needed "serializer" is not available.');var D=function(e){return e instanceof Error?""+e:P(e)},z=function(e){return"string"==typeof e?e.trim():""},R=function(e){if(y)null!==e&&"number"!=typeof e&&(e=new Date(e),e=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())/1e3);else if(null!==e){e=new Date("number"!=typeof e||isNaN(e)?e:1e3*e);try{e=e.toISOString()}catch(e){}}return e},U=function(e,t,r){if(r.fileName){if(r.fileName.value)return r.fileName.value===t;if(r.fileName.regularExpressionPattern)return new RegExp(r.fileName.regularExpressionPattern).test(t)}return e===t},M=function(t,r){if(r||(r=e[d.attachment]),t){for(var n,o=0,a=Object.keys(r);o<a.length;o++)if((n=a[o]).startsWith(t))return n}else{var i=Object.keys(r);if(i.length)return i[0]}return null},_=function(e,r,n){void 0===r&&(r=!1),void 0===n&&(n={});var a=z(e);if(a){var i,l=(r?"return ":"")+a,c=o({},L,{code:l},n),p=Object.keys(c);try{i=t(Function,p.concat([l]))}catch(e){s(D(e),"compilation",{code:l,error:e,scope:c})}var u={code:l,result:void 0,scope:c};try{u.result=i.apply(void 0,p.map((function(e){return c[e]})))}catch(e){s(D(e),"runtime",{code:l,error:e,scope:c})}return u}s("No expression to evaluate provided.","empty")},H=function(e,r,n){void 0===n&&(n=[]);var o=n.length?" in "+n.join(" -> "):"",i=[],p=function(){Object.prototype.hasOwnProperty.call(e,g)||(r&&Object.prototype.hasOwnProperty.call(r,g)&&["fillUp","migrate"].includes(w)?e[g]=r[g]:s('Type: You have to specify a model type via property "'+g+'"'+o+".")),n.length||new RegExp(l.property.name.typeRegularExpressionPattern.public).test(e[g])||s('TypeName: You have to specify a model type which matches "'+l.property.name.typeRegularExpressionPattern.public+'" as public type (given "'+e[g]+'")'+o+"."),Object.prototype.hasOwnProperty.call(c,e[g])||(Object.prototype.hasOwnProperty.call(j,e[g])?e[g]=j[e[g]]:s('Model: Given model "'+e[g]+'" is not specified'+o+"."))};p();var u=e[g],m=c[u],v=null;Object.prototype.hasOwnProperty.call(m,d.additional)&&m[d.additional]&&(v=m[d.additional]);var O=function i(l,c,p,y,d){void 0===d&&(d=["constraintExecution","constraintExpression"]);for(var f,h,g=a(d);!(f=g()).done;)if(h=f.value,Object.prototype.hasOwnProperty.call(p,h)){var v,O=void 0;try{O=_(p[h].evaluation,h.endsWith("Expression"),{checkPropertyContent:i,model:m,modelName:u,name:c,type:h,newDocument:e,newValue:l,oldDocument:r,oldValue:y,parentNames:n,pathDescription:o,propertySpecification:p})}catch(c){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(c)&&s('Compilation: Hook "'+h+'" has invalid code "'+c.code+'": "'+c.message+'"'+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(c)&&s('Runtime: Hook "'+h+'" has throw an error with code "'+c.code+'": "'+c.message+'"'+o+"."),!Object.prototype.hasOwnProperty.call(c,"empty"))throw c}if(null==(v=O)||!v.result){var b=z(p[h].description);s(h.charAt(0).toUpperCase()+(h.substring(1)+": ")+(b?t(Function,Object.keys(O.scope).concat(["return "+b])).apply(void 0,Object.values(O.scope)):'Property "'+c+'" should satisfy constraint "'+O.code+'" (given "'+D(l)+'")'+o+"."))}}},P=function(e,t,r,i){void 0===i&&(i=null);var l=[],p=[].concat(r.type?r.type:[]);"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&!Object.prototype.hasOwnProperty.call(e,g)&&1===p.length&&Object.prototype.hasOwnProperty.call(c,p[0])&&(e[g]=p[0]);for(var u,m,d=!1,h=a(p);!(u=h()).done;)if(m=u.value,Object.prototype.hasOwnProperty.call(c,m)){if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,g)&&e[g]!==m&&"migrate"===w&&1===p.length&&(e[g]=m,l=n.concat(t,"migrate nested object type")),"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,g)&&e[g]===m){var v=H(e,i,n.concat(t));if(v.changedPath.length&&(l=v.changedPath),e=v.newDocument,D(e)===D({}))return{newValue:null,changedPath:l};d=!0;break}1===p.length&&s('NestedType: Under key "'+t+'" isn\'t of type "'+m+'" (given "'+D(e)+'" of type '+typeof e+")"+o+".")}else if("DateTime"===m){var b=e;if(e=R(e),!(y&&("number"!=typeof e||isNaN(e))||!y&&"string"!=typeof e)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t of (valid) type "DateTime" (given "'+D(b).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof b+'")'+o+".")}else if(["boolean","integer","number","string"].includes(m)){if(!("number"==typeof e&&isNaN(e)||"integer"!==m&&typeof e!==m||"integer"===m&&parseInt(e,10)!==e)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t of (valid) type "${type}" (given "'+D(e)+'" of type "'+typeof e+'")'+o+".")}else if("string"==typeof m&&m.startsWith("foreignKey:")){var P=c[m.substring(11)][f].type;if(P===typeof e){d=!0;break}1===p.length&&s('PropertyType: Foreign key property "'+t+'" isn\'t of type "'+P+'" (given "'+D(e)+'" of type "'+typeof e+'")'+o+".")}else{if("any"===m||D(e)===D(m)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t value "'+m+'" (given "'+D(e).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof e+'")'+o+".")}if(d||s('PropertyType: None of the specified types "'+p.join('", "')+'" for property "'+t+'" matches value "'+D(e).replace(/^"/,"").replace(/"$/,"")+e+'" of type "'+typeof e+'")'+o+"."),"string"==typeof e&&(![null,void 0].includes(r.minimumLength)&&e.length<r.minimumLength&&s('MinimalLength: Property "'+t+'" must have minimal length '+r.minimumLength+" (given "+e+" with length i"+e.length+") "+o+"."),![null,void 0].includes(r.maximumLength)&&e.length>r.maximumLength&&s('MaximalLength: Property "'+t+'" must have maximal length '+r.maximumLength+" (given "+e+" with length "+e.length+")"+o+".")),"number"==typeof e&&(![null,void 0].includes(r.minimum)&&e<r.minimum&&s('Minimum: Property "'+t+'" (type '+r.type+") must satisfy a minimum of "+r.minimum+" (given "+e+" is too low)"+o+"."),![null,void 0].includes(r.maximum)&&e>r.maximum&&s('Maximum: Property "'+t+'" (type '+r.type+") must satisfy a maximum of "+r.maximum+" (given "+e+" is too high)"+o+".")),r.selection){var j=Array.isArray(r.selection)?r.selection.map((function(e){return void 0===(null==e?void 0:e.value)?e:e.value})):Object.keys(r.selection);"DateTime"===r.type&&(j=j.map(R)),j.includes(e)||s('Selection: Property "'+t+'" (type '+r.type+') should be one of "'+j.join('", "')+'". But is "'+e+'"'+o+".")}return[null,void 0].includes(r.regularExpressionPattern)||new RegExp(r.regularExpressionPattern).test(e)?![null,void 0].includes(r.invertedRegularExpressionPattern)&&new RegExp(r.invertedRegularExpressionPattern).test(e)&&s('InvertedPatternMatch: Property "'+t+'" should not match regular expression pattern '+r.invertedRegularExpressionPattern+' (given "'+e+'")'+o+"."):s('PatternMatch: Property "'+t+'" should match regular expression pattern '+r.regularExpressionPattern+' (given "'+e+'")'+o+"."),O(e,t,r,i),D(e)!==D(i)&&(l=n.concat(t,"value updated")),{newValue:e,changedPath:l}},x=function(e,t,r,o,a){var c=t[o];if(!e.writable)if(r){if(Object.prototype.hasOwnProperty.call(r,o)&&D(c)===D(r[o]))return o!==f&&"incremental"===w&&delete t[o],!0;s('Readonly: Property "'+o+'" is not writable (old document "'+D(r)+'")'+a+".")}else s('Readonly: Property "'+o+'" is not writable'+a+".");if(!e.mutable&&r&&Object.prototype.hasOwnProperty.call(r,o)){if(D(c)===D(r[o]))return"incremental"!==w||l.property.name.reserved.concat(d.deleted,f,h).includes(o)||delete t[o],!0;"migrate"!==w&&s('Immutable: Property "'+o+'" is not writable (old document "'+D(r)+'")'+a+".")}if(null===c){if(e.nullable)return delete t[o],r&&Object.prototype.hasOwnProperty.call(r,o)&&(i=n.concat(o,"delete property")),!0;s('NotNull: Property "'+o+'" should not be "null"'+a+".")}return!1},N=function(e,t,r,i){if(!r)for(var l,c,p=a(["onCreateExecution","onCreateExpression"]);!(l=p()).done;)if(c=l.value,Object.prototype.hasOwnProperty.call(e,c)){var y=void 0;try{y=_(e[c],c.endsWith("Expression"),{checkPropertyContent:P,model:m,modelName:u,name:i,type:c,newDocument:t,oldDocument:r,newValue:void 0,oldValue:void 0,parentNames:n,pathDescription:o,propertySpecification:e})}catch(l){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(l)&&s('Compilation: Hook "'+c+'" has invalid code "'+l.code+'" for property "'+i+'": '+l.message+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(l)&&s('Runtime: Hook "'+c+'" has throw an error with code "'+l.code+'" for property "'+i+'": '+l.message+o+"."),!Object.prototype.hasOwnProperty.call(l,"empty"))throw l}y&&![null,void 0].includes(y.result)&&(t[i]=y.result)}},A=function(e,t,r,i){if(Object.prototype.hasOwnProperty.call(t,i)){e.trim&&"string"==typeof t[i]&&(t[i]=t[i].trim()),e.emptyEqualsToNull&&(""===t[i]||Array.isArray(t[i])&&0===t[i].length||null!==t[i]&&"object"==typeof t[i]&&0===Object.keys(t).length)&&(t[i]=null);for(var l,c,p=a(["onUpdateExecution","onUpdateExpression"]);!(l=p()).done;)if(c=l.value,Object.prototype.hasOwnProperty.call(e,c))try{t[i]=_(e[c],c.endsWith("Expression"),{checkPropertyContent:P,model:m,modelName:u,name:i,type:c,newDocument:t,oldDocument:r,newValue:t[i],oldValue:r&&r[i],parentNames:n,pathDescription:o,propertySpecification:e}).result}catch(l){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(l)&&s('Compilation: Hook "'+c+'" has invalid code "'+l.code+'" for property "'+i+'": '+l.message+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(l)&&s('Runtime: Hook "'+c+'" has throw an error with code "'+l.code+'" for property "'+i+'": '+l.message+o+"."),!Object.prototype.hasOwnProperty.call(l,"empty"))throw l}}},C=Object.keys(m).filter((function(e){return![d.additional,d.allowedRoles,d.constraint.execution,d.constraint.expression,d.create.execution,d.create.expression,d.extend,d.maximumAggregatedSize,d.minimumAggregatedSize,d.oldType,d.update.execution,d.update.expression].includes(e)}));if("migrate"===w)for(var S,k,T=a(C);!(S=T()).done;)if(k=S.value,![null,void 0].includes(m[k].oldName))for(var E,M,L=a([].concat(m[k].oldName));!(E=L()).done;)M=E.value,Object.prototype.hasOwnProperty.call(e,M)&&(e[k]=e[M],delete e[M]);if(!r)for(var I,W=0,V=[d.create.execution,d.create.expression];W<V.length;W++)if(I=V[W],Object.prototype.hasOwnProperty.call(m,I)){var F=void 0;try{F=_(m[I],I.endsWith("Expression"),{checkPropertyContent:P,model:m,modelName:u,type:I,newDocument:e,oldDocument:r,parentNames:n,pathDescription:o}).result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+I+'" has invalid code "'+e.code+'" for document "'+u+'": '+e.message+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+I+'" has throw an error with code "'+e.code+'" for document "'+u+'": '+e.message+o+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}[null,void 0].includes(F)||(e=F),p(),u=e[g],0===n.length&&b()}for(var B,$=0,q=[d.update.execution,d.update.expression];$<q.length;$++)if(B=q[$],Object.prototype.hasOwnProperty.call(m,B)){var Y=void 0;try{Y=_(m[B],B.endsWith("Expression"),{checkPropertyContent:P,model:m,modelName:u,type:B,newDocument:e,oldDocument:r,parentNames:n,pathDescription:o}).result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+B+'" has invalid code "'+e.code+'" for document "'+u+'": '+e.message+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+B+'" has throw an error with code "'+e.code+'" for document "'+u+'": '+e.message+o+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}[void 0,null].includes(Y)||(e=Y),p(),u=e[g],0===n.length&&b()}for(var J,G=function t(){var o=J.value;if(d.attachment===o)for(var l=function(){var l=p[c],s=l[0],u=l[1];Object.prototype.hasOwnProperty.call(e,o)&&null!==e[o]||(e[o]={}),r&&!Object.prototype.hasOwnProperty.call(r,o)&&(r[o]={});var m=Object.keys(e[o]).filter((function(t){return null!==e[o][t].data&&U(s,t,u)})),y=e[o],d=[];if(r){var f=r[o];d=Object.keys(f).filter((function(e){return!(Object.prototype.hasOwnProperty.call(y,e)&&Object.prototype.hasOwnProperty.call(y[e],"data")&&null===y[e].data)&&!!f[e]&&(Object.prototype.hasOwnProperty.call(f[e],"data")&&null!==f[e].data||f[e].stub&&!!f[e].digest)&&!!U(s,e,u)}))}for(var h,g,v=u,O=a(m);!(h=O()).done;)g=h.value,N(v,y,r&&r[o]?r[o]:null,g);for(var b,P,j=a(m);!(b=j()).done;)P=b.value,A(v,y,r&&r[o]?r[o]:null,P);if([null,void 0].includes(v.default)){if(v.nullable||0<m.length||0<d.length||t(),"fillUp"===w&&0===m.length&&0<d.length)for(var x,C,S=a(d);!(x=S()).done;)C=x.value,null===y[C]?i=n.concat(o,C,"file removed"):y[C]=r[o][C]}else if(0===m.length)if(0===d.length)for(var k in v.default)Object.prototype.hasOwnProperty.call(v.default,k)&&(y[k]=v.default[k],i=n.concat(o,s,"add default file"));else if("fillUp"===w)for(var T,E,D=a(d);!(T=D()).done;)E=T.value,y[E]=r[o][E]},c=0,p=Object.entries(m[o]);c<p.length;c++)l();else{var s=C.includes(o)?m[o]:v;N(s,e,r,o),A(s,e,r,o),[null,void 0].includes(s.default)?(!(s.nullable||Object.prototype.hasOwnProperty.call(e,o)||r&&Object.prototype.hasOwnProperty.call(r,o)&&w)&&t(),!Object.prototype.hasOwnProperty.call(e,o)&&r&&Object.prototype.hasOwnProperty.call(r,o)&&("fillUp"===w?e[o]=r[o]:!w&&(i=n.concat(o,"property removed")))):(!Object.prototype.hasOwnProperty.call(e,o)||null===e[o])&&(r&&Object.prototype.hasOwnProperty.call(r,o)?"fillUp"===w?e[o]=r[o]:"migrate"===w&&(e[o]=s.default,i=n.concat(o,"migrate default value")):(e[o]=s.default,i=i.concat(o,"add default value")))}},K=a(C.concat(v?Object.keys(e).filter((function(e){return!C.includes(e)})):[]));!(J=K()).done;)G();if(r&&"incremental"===w)for(var Z=0,Q=Object.entries(e);Z<Q.length;Z++){var X=Q[Z],ee=X[0],te=X[1];!Object.prototype.hasOwnProperty.call(r,ee)||l.property.name.reserved.concat(f,h,d.conflict,d.deleted,d.deletedConflict,d.localSequence,d.revisions,d.revisionsInformation,g).includes(ee)||r[ee]!==te&&D(r[ee])!==D(te)||delete e[ee]}for(var re=0,ne=Object.entries(e);re<ne.length;re++){var oe=ne[re],ae=oe[0],ie=oe[1];if(!l.property.name.reserved.concat(h,d.conflict,d.deleted,d.deletedConflict,d.localSequence,d.revisions,d.revisionsInformation,d.strategy).includes(ae)){var le=void 0;if(Object.prototype.hasOwnProperty.call(m,ae))le=m[ae];else if(v)le=v;else{if("migrate"===w){delete e[ae],i=n.concat(ae,"migrate removed property");continue}s('Property: Given property "'+ae+'" isn\'t specified in model "'+u+'"'+o+".")}if(!le)continue;if(d.attachment===ae){var ce=ie;for(var pe in ce)if(Object.prototype.hasOwnProperty.call(ce,pe))for(var se in m[ae])if(U(se,pe,m[ae][se])){x(m[ae][se],e,r,pe,o);break}continue}if(x(le,e,r,ae,o))continue;if("string"==typeof le.type&&le.type.endsWith("[]")||Array.isArray(le.type)&&le.type.length&&Array.isArray(le.type[0])){var ue,me=ie;Array.isArray(me)?![null,void 0].includes(le.minimumNumber)&&me.length<le.minimumNumber?s('MinimumArrayLength: Property "'+ae+'" (array of length '+me.length+") doesn't fullfill minimum array length of "+le.minimumNumber+o+"."):![null,void 0].includes(le.maximumNumber)&&le.maximumNumber<me.length&&s('MaximumArrayLength: Property "'+ae+'" (array of length '+me.length+") doesn't fullfill maximum array length of "+le.maximumNumber+o+"."):s('PropertyType: Property "'+ae+'" isn\'t of type "array -> '+le.type+'" (given "'+D(me)+'")'+o+"."),O(me,ae,le,r&&Object.prototype.hasOwnProperty.call(r,ae)&&r[ae]||void 0,["arrayConstraintExecution","arrayConstraintExpression"]);var ye={};for(var de in le)Object.prototype.hasOwnProperty.call(le,de)&&(ye[de]="type"===de?Array.isArray(le[de])?le[de][0]:[le[de].substring(0,le.type.length-2)]:le[de]);if(1===(null==(ue=ye.type)?void 0:ue.length)&&Object.prototype.hasOwnProperty.call(c,ye.type[0]))for(var fe,he,ge=a(me.slice());!(fe=ge()).done;)"object"!=typeof(he=fe.value)||Object.getPrototypeOf(he)!==Object.prototype||Object.prototype.hasOwnProperty.call(he,g)||(he[g]=ye.type[0]);for(var ve,Oe,be=0,we=a(me.slice());!(ve=we()).done;)Oe=ve.value,me[be]=P(Oe,be+1+". value in "+ae,ye).newValue,null===Oe&&me.splice(be,1),be+=1;r&&Object.prototype.hasOwnProperty.call(r,ae)&&Array.isArray(r[ae])&&r[ae].length===me.length&&D(r[ae])===D(me)||(i=n.concat(ae,"array updated"))}else{var Pe=r&&Object.prototype.hasOwnProperty.call(r,ae)?r[ae]:null,je=P(ie,ae,le,Pe);e[ae]=je.newValue,je.changedPath.length&&(i=je.changedPath),null===e[ae]&&(null!==Pe&&(i=n.concat(ae,"property removed")),delete e[ae])}}}for(var xe,Ne=0,Ae=Object.keys(d.constraint);Ne<Ae.length;Ne++)if(xe=Ae[Ne],(xe=d.constraint[xe])&&Object.prototype.hasOwnProperty.call(m,xe))for(var Ce,Se=a([].concat(m[xe]));!(Ce=Se()).done;){var ke,Te=Ce.value,Ee=void 0;try{Ee=_(Te.evaluation,xe===d.constraint.expression,{checkPropertyContent:P,model:m,modelName:u,type:xe,newDocument:e,oldDocument:r,parentNames:n,pathDescription:o})}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+xe+'" has invalid code "'+e.code+'": "'+e.message+'"'+o+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+xe+'" has thrown an error with code "'+e.code+'": '+e.message+o+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}if(null==(ke=Ee)||!ke.result){var De=xe.replace(/^[^a-zA-Z]+/,"");s(De.charAt(0).toUpperCase()+(De.substring(1)+": ")+(Te.description?t(Function,Object.keys(Ee.scope).concat(["return "+Te.description.trim()])).apply(void 0,Object.values(Ee.scope)):'Model "'+u+'" should satisfy constraint "'+Ee.code+'" (given "'+D(e)+'")'+o+"."))}}if(Object.prototype.hasOwnProperty.call(e,d.attachment)){var ze=e[d.attachment];("object"!=typeof ze||Object.getPrototypeOf(ze)!==Object.prototype)&&s("AttachmentType: given attachment has invalid type"+o+".");var Re=null;if(r&&Object.prototype.hasOwnProperty.call(r,d.attachment)&&null!==(Re=r[d.attachment])&&"object"==typeof Re)for(var Ue=0,Me=Object.entries(Re);Ue<Me.length;Ue++){var _e=Me[Ue],He=_e[0],Le=_e[1];if(Object.prototype.hasOwnProperty.call(ze,He)){var Ie=ze[He];null===Ie||null===Ie.data||Ie.content_type===Le.content_type&&(Ie.data===Le.data||Ie.digest===Le.digest)?((null===Ie||null===Ie.data)&&(i=n.concat(d.attachment,He,"attachment removed")),"incremental"===w&&delete ze[He]):i=n.concat(d.attachment,He,"attachment updated")}else"fillUp"===w?ze[He]=Le:w||(i=n.concat(d.attachment,He,"attachment removed"))}for(var We=0,Ve=Object.entries(ze);We<Ve.length;We++){var Fe=Ve[We],Be=Fe[0],$e=Fe[1];[null,void 0].includes($e)||null===$e.data?delete ze[Be]:(!Re||!Object.prototype.hasOwnProperty.call(Re,Be)||$e.content_type!==Re[Be].content_type||$e.data!==Re[Be].data&&$e.digest!==Re[Be].digest)&&(i=n.concat(d.attachment,Be,"attachment updated"))}0===Object.keys(ze).length&&delete e[d.attachment];for(var qe={},Ye=0,Je=Object.keys(m[d.attachment]);Ye<Je.length;Ye++)qe[Je[Ye]]=[];for(var Ge=0,Ke=Object.keys(ze);Ge<Ke.length;Ge++){for(var Ze=Ke[Ge],Qe=!1,Xe=0,et=Object.entries(m[d.attachment]);Xe<et.length;Xe++){var tt=et[Xe],rt=tt[0],nt=tt[1];if(U(rt,Ze,nt)){qe[rt].push(Ze),Qe=!0;break}}Qe||s('AttachmentTypeMatch: None of the specified attachment types ("'+Object.keys(m[d.attachment]).join('", "')+'") matches given one ("'+Ze+'")'+o+".")}for(var ot=0,at=0,it=Object.keys(qe);at<it.length;at++){var lt=it[at],ct=m[d.attachment][lt];if(Object.prototype.hasOwnProperty.call(qe,lt)){var pt=qe[lt].length;null!==ct.maximumNumber&&pt>ct.maximumNumber&&s("AttachmentMaximum: given number of attachments ("+pt+") doesn't satisfy specified maximum of "+ct.maximumNumber+' from type "'+lt+'"'+o+"."),(!ct.nullable||0!==pt)&&pt<ct.minimumNumber&&s("AttachmentMinimum: given number of attachments ("+pt+") doesn't satisfy specified minimum of "+ct.minimumNumber+' from type "'+lt+'"'+o+".");for(var st,ut=0,mt=a(qe[lt]);!(st=mt()).done;){var yt,dt,ft=st.value;null!=(yt=ct.fileName)&&yt.regularExpressionPattern&&!new RegExp(ct.fileName.regularExpressionPattern).test(ft)?s('AttachmentName: given attachment name "'+ft+'" doesn\'t satisfy specified regular expression pattern "'+ct.fileName.regularExpressionPattern+'" from type "'+lt+'"'+o+"."):null!=(dt=ct.fileName)&&dt.invertedRegularExpressionPattern&&new RegExp(ct.fileName.invertedRegularExpressionPattern).test(ft)?s('InvertedAttachmentName: given attachment name "'+ft+'" does satisfy specified regular expression pattern "'+ct.fileName.invertedRegularExpressionPattern+'" from type "'+lt+'"'+o+"."):!([null,void 0].includes(ct.contentTypeRegularExpressionPattern)||ze[ft].content_type&&new RegExp(ct.contentTypeRegularExpressionPattern).test(ze[ft].content_type))&&s('AttachmentContentType: given attachment content type "'+ze[ft].content_type+'" doesn\'t satisfy specified regular expression pattern "'+ct.contentTypeRegularExpressionPattern+'" from type "'+lt+'"'+o+".");var ht=ct.invertedContentTypeRegularExpressionPattern;[null,void 0].includes(ht)||ze[ft].content_type&&!new RegExp(ht).test(ze[ft].content_type)||s('InvertedAttachmentContentType: given attachment content type "'+ze[ft].content_type+'" does satisfy specified regular expression pattern "'+ht+'" from type "'+lt+'"'+o+".");var gt=0;"length"in ze[ft]?gt=ze[ft].length:"data"in ze[ft]&&(gt=Buffer&&"byteLength"in Buffer?Buffer.byteLength(ze[ft].data,"base64"):ze[ft].data.length),![null,void 0].includes(ct.minimumSize)&&ct.minimumSize>gt?s("AttachmentMinimumSize: given attachment size "+gt+" byte doesn't satisfy specified minimum of "+ct.minimumSize+" byte "+o+"."):![null,void 0].includes(ct.maximumSize)&&ct.maximumSize<gt&&s("AttachmentMaximumSize: given attachment size "+gt+" byte doesn't satisfy specified maximum of "+ct.maximumSize+" byte "+o+"."),ut+=gt}![null,void 0].includes(ct.minimumAggregatedSize)&&ct.minimumAggregatedSize>ut?s('AttachmentAggregatedMinimumSize: given aggregated size of attachments from type "'+lt+'" '+ut+" byte doesn't satisfy specified minimum of "+ct.minimumAggregatedSize+" byte "+o+"."):![null,void 0].includes(ct.maximumAggregatedSize)&&ct.maximumAggregatedSize<ut&&s('AttachmentAggregatedMaximumSize: given aggregated size of attachments from type "'+lt+'" '+ut+" byte doesn't satisfy specified maximum of "+ct.maximumAggregatedSize+" byte "+o+"."),ot+=ut}}Object.prototype.hasOwnProperty.call(m,d.minimumAggregatedSize)&&![null,void 0].includes(m[d.minimumAggregatedSize])&&m[d.minimumAggregatedSize]>ot?s("AggregatedMinimumSize: given aggregated size "+ot+" byte doesn't satisfy specified minimum of "+m[d.minimumAggregatedSize]+" byte "+o+"."):![null,void 0].includes(m[d.maximumAggregatedSize])&&m[d.maximumAggregatedSize]<ot&&s("AggregatedMaximumSize: given aggregated size "+ot+" byte doesn't satisfy specified maximum of "+m[d.maximumAggregatedSize]+" byte "+o+".")}if(r&&Object.prototype.hasOwnProperty.call(r,d.attachment)&&0===Object.keys(r[d.attachment]).length&&delete r[d.attachment],0===i.length&&r&&"migrate"===w)for(var vt,Ot=0,bt=Object.keys(r);Ot<bt.length;Ot++)vt=bt[Ot],Object.prototype.hasOwnProperty.call(e,vt)||(i=n.concat(vt,"migrate removed property"));return{changedPath:i,newDocument:e}},L={attachmentWithPrefixExists:function(t){if(Object.prototype.hasOwnProperty.call(e,d.attachment)){var r=e[d.attachment],n=M(t);if(n)return Object.prototype.hasOwnProperty.call(r[n],"stub")&&r[n].stub||Object.prototype.hasOwnProperty.call(r[n],"data")&&![null,void 0].includes(r[n].data)}return!1},checkDocument:H,getFileNameByPrefix:M,serialize:D,id:v,revision:O,idName:f,revisionName:h,specialNames:d,typeName:g,modelConfiguration:l,models:c,now:u,nowUTCTimestamp:m,securitySettings:i,userContext:n},I=H(e,r);return(!I.newDocument._deleted||r)&&(I.newDocument._deleted&&I.newDocument._deleted!==(null==r?void 0:r._deleted)||I.changedPath.length)||s("NoChange: No new data given. new document: "+D(e)+"; old document: "+D(r)+"."),Object.prototype.hasOwnProperty.call(i,l.property.name.validatedDocumentsCache)?i[l.property.name.validatedDocumentsCache].add(v+"-"+O):i[l.property.name.validatedDocumentsCache]=new Set([v+"-"+O]),I.newDocument},e}(),s=p;e.exports=c}()}],t={};var r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(0);module.exports=r})();