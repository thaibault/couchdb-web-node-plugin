m+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+q+'" has throw an error with code "'+e.code+'" for document "'+m+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}[void 0,null].includes(J)||(e=J),p(),m=e[g],0===n.length&&O()}for(var G,K,Z=u?Object.keys(e).filter((function(e){return!S.includes(e)})):[],Q=o(S.concat(Z));!(G=Q()).done;)if(K=G.value,d.attachment===K)for(var X=function(){var t=te[ee],l=t[0],c=t[1];Object.prototype.hasOwnProperty.call(e,K)&&null!==e[d.attachment]||(e[d.attachment]={}),r&&!Object.prototype.hasOwnProperty.call(r,K)&&(r[d.attachment]={});var p=Object.keys(e[d.attachment]).filter((function(t){return null!==e[d.attachment][t].data&&U(l,t,c)})),u=e[d.attachment],m=[];if(r){var y=r[K];m=Object.keys(y).filter((function(e){return!(Object.prototype.hasOwnProperty.call(u,e)&&Object.prototype.hasOwnProperty.call(u[e],"data")&&null===u[e].data)&&!!y[e]&&(Object.prototype.hasOwnProperty.call(y[e],"data")&&null!==y[e].data||y[e].stub&&!!y[e].digest)&&!!U(l,e,c)}))}for(var f,h,g=c,v=o(p);!(f=v()).done;)h=f.value,N(g,e,r&&r[K]?r[K]:null,h,u);for(var b,O,P=o(p);!(b=P()).done;)O=b.value,A(g,e,r&&r[K]?r[K]:null,O,u);if(void 0===g.default){if(g.nullable||0<p.length||0<m.length||s('AttachmentMissing: Missing attachment for type "'+l+'"'+a+"."),"fillUp"===w&&0===p.length&&0<m.length)for(var j,x,S=o(m);!(j=S()).done;)x=j.value,null===u[x]?i=n.concat(K,x,"file removed"):u[x]=r[K][x]}else if(0===p.length)if(0===m.length)for(var C in g.default)Object.prototype.hasOwnProperty.call(g.default,C)&&(u[C]=g.default[C],i=n.concat(K,l,"add default file"));else if("fillUp"===w)for(var k,T,D=o(m);!(k=D()).done;)T=k.value,u[T]=r[K][T]},ee=0,te=Object.entries(v[d.attachment]);ee<te.length;ee++)X();else{var re=S.includes(K)?v[K]:u;N(re,e,r,K),A(re,e,r,K),[null,void 0].includes(re.default)?(!(re.nullable||Object.prototype.hasOwnProperty.call(e,K)&&void 0!==e[K]||r&&Object.prototype.hasOwnProperty.call(r,K)&&w)&&s('MissingProperty: Missing property "'+K+'"'+a+"."),(!Object.prototype.hasOwnProperty.call(e,K)||void 0===e[K])&&r&&Object.prototype.hasOwnProperty.call(r,K)&&("fillUp"===w?e[K]=r[K]:!w&&(i=n.concat(K+"","property removed")))):(!Object.prototype.hasOwnProperty.call(e,K)||[null,void 0].includes(e[K]))&&(r?null!==e[K]&&"fillUp"===w?e[K]=r[K]:"migrate"===w&&(e[K]=re.default,i=n.concat(K+"","migrate default value")):(e[K]=re.default,i=i.concat(K+"","add default value")))}if(r&&"incremental"===w)for(var ne=0,oe=Object.entries(e);ne<oe.length;ne++){var ae=oe[ne],ie=ae[0],le=ae[1];Object.prototype.hasOwnProperty.call(r,ie)&&!l.property.name.reserved.concat(f,h,d.conflict,d.deleted,d.deletedConflict,d.localSequence,d.revisions,d.revisionsInformation,g).includes(ie)&&(r[ie]===le||z(r[ie])===z(le))&&delete e[ie]}for(var ce=0,pe=Object.entries(e);ce<pe.length;ce++){var se=pe[ce],ue=se[0],me=se[1];if(!l.property.name.reserved.concat(h,d.conflict,d.deleted,d.deletedConflict,d.localSequence,d.revisions,d.revisionsInformation,d.strategy).includes(ue)){var ye=void 0;if(Object.prototype.hasOwnProperty.call(v,ue))ye=v[ue];else if(u)ye=u;else{if("migrate"===w){delete e[ue],i=n.concat(ue+"","migrate removed property");continue}s('Property: Given property "'+ue+'" isn\'t specified in model "'+m+'"'+a+".")}if(!ye)continue;if(d.attachment===ue){var de=me;for(var fe in de)if(Object.prototype.hasOwnProperty.call(de,fe))for(var he in v[ue])if(U(he,fe,v[d.attachment][he])){x(v[d.attachment][he],e,r,fe,a);break}continue}if(x(ye,e,r,ue,a))continue;var ge="string"==typeof ye.type&&ye.type.endsWith("[]")||Array.isArray(ye.type)&&ye.type.length&&Array.isArray(ye.type[0]);if(ge&&![null,void 0].includes(me)){var ve,be=me;Array.isArray(be)?"number"==typeof ye.minimumNumber&&be.length<ye.minimumNumber?s('MinimumArrayLength: Property "'+ue+'" (array of length '+be.length+") doesn't fullfill minimum array length of "+ye.minimumNumber+a+"."):"number"==typeof ye.maximumNumber&&ye.maximumNumber<be.length&&s('MaximumArrayLength: Property "'+ue+'" (array of length '+be.length+") doesn't fullfill maximum array length of "+ye.maximumNumber+a+"."):s('PropertyType: Property "'+ue+'" isn\'t of type "array -> '+ye.type+'" (given "'+z(be)+'")'+a+"."),b(be,ue+"",ye,r&&Object.prototype.hasOwnProperty.call(r,ue)&&r[ue]||void 0,["arrayConstraintExecution","arrayConstraintExpression"]);var Oe={};for(var we in ye)Object.prototype.hasOwnProperty.call(ye,we)&&(Oe[we]="type"===we?Array.isArray(ye[we])?ye[we][0]:[ye[we].substring(0,ye.type.length-2)]:ye[we]);if(1===(null==(ve=Oe.type)?void 0:ve.length)&&Object.prototype.hasOwnProperty.call(c,Oe.type[0]))for(var Pe,je,xe=o(be.slice());!(Pe=xe()).done;)"object"!=typeof(je=Pe.value)||Object.getPrototypeOf(je)!==Object.prototype||Object.prototype.hasOwnProperty.call(je,g)||(je[g]=Oe.type[0]);for(var Ne,Ae,Se=0,Ce=o(be.slice());!(Ne=Ce()).done;)Ae=Ne.value,be[Se]=P(Ae,Se+1+". value in "+ue,Oe).newValue,[null,void 0].includes(be[Se])&&be.splice(Se,1),Se+=1;r&&Object.prototype.hasOwnProperty.call(r,ue)&&Array.isArray(r[ue])&&r[ue].length===be.length&&z(r[ue])===z(be)||(i=n.concat(ue+"","array updated"))}else{var ke=r&&Object.prototype.hasOwnProperty.call(r,ue)?r[ue]:null,Te=ge?{newValue:null,changedPath:[]}:P(me,ue+"",ye,ke);e[ue]=Te.newValue,Te.changedPath.length&&(i=Te.changedPath),[null,void 0].includes(e[ue])&&(null!==ke&&(i=n.concat(ue+"","property removed")),("incremental"!==w||null!==ke)&&delete e[ue])}}}for(var De=0,Ee=Object.keys(d.constraint);De<Ee.length;De++){var ze=Ee[De],Me=d.constraint[ze];if(Object.prototype.hasOwnProperty.call(v,Me))for(var Re,Ue=o([].concat(v[Me]));!(Re=Ue()).done;){var _e=Re.value,He=void 0;try{He=H(_e.evaluation,Me===d.constraint.expression,{checkPropertyContent:P,model:v,modelName:m,type:Me,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a})}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+Me+'" has invalid code "'+e.code+'": "'+e.message+'"'+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+Me+'" has thrown an error with code "'+e.code+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}if(He&&!He.result){var Le=Me.replace(/^[^a-zA-Z]+/,"");s(Le.charAt(0).toUpperCase()+(Le.substring(1)+": ")+(_e.description?t(Function,Object.keys(He.scope).concat(["return "+_e.description.trim()])).apply(void 0,Object.values(He.scope)):'Model "'+m+'" should satisfy constraint "'+He.code+'" (given "'+z(e)+'")'+a+"."))}}}if(Object.prototype.hasOwnProperty.call(e,d.attachment)){var Ie=e[d.attachment];("object"!=typeof Ie||Object.getPrototypeOf(Ie)!==Object.prototype)&&s("AttachmentType: given attachment has invalid type"+a+".");var Ve=null;if(r&&Object.prototype.hasOwnProperty.call(r,d.attachment)&&null!==(Ve=r[d.attachment])&&"object"==typeof Ve)for(var We=0,Fe=Object.entries(Ve);We<Fe.length;We++){var Be=Fe[We],qe=Be[0],Ye=Be[1];if(Object.prototype.hasOwnProperty.call(Ie,qe)){var $e=Ie[qe];null===$e||null===$e.data||$e.content_type===Ye.content_type&&($e.data===Ye.data||$e.digest===Ye.digest)?((null===$e||null===$e.data)&&(i=n.concat(d.attachment,qe,"attachment removed")),"incremental"===w&&delete Ie[qe]):i=n.concat(d.attachment,qe,"attachment updated")}else"fillUp"===w?Ie[qe]=Ye:w||(i=n.concat(d.attachment,qe,"attachment removed"))}for(var Je=0,Ge=Object.entries(Ie);Je<Ge.length;Je++){var Ke=Ge[Je],Ze=Ke[0],Qe=Ke[1];[null,void 0].includes(Qe)||null===Qe.data?delete Ie[Ze]:(!Ve||!Object.prototype.hasOwnProperty.call(Ve,Ze)||Qe.content_type!==Ve[Ze].content_type||Qe.data!==Ve[Ze].data&&Qe.digest!==Ve[Ze].digest)&&(i=n.concat(d.attachment,Ze,"attachment updated"))}0===Object.keys(Ie).length&&delete e[d.attachment];for(var Xe={},et=0,tt=Object.keys(v[d.attachment]);et<tt.length;et++)Xe[tt[et]]=[];for(var rt=0,nt=Object.keys(Ie);rt<nt.length;rt++){for(var ot=nt[rt],at=!1,it=0,lt=Object.entries(v[d.attachment]);it<lt.length;it++){var ct=lt[it],pt=ct[0],st=ct[1];if(U(pt,ot,st)){Xe[pt].push(ot),at=!0;break}}at||s('AttachmentTypeMatch: None of the specified attachment types ("'+Object.keys(v[d.attachment]).join('", "')+'") matches given one ("'+ot+'")'+a+".")}for(var ut=0,mt=0,yt=Object.keys(Xe);mt<yt.length;mt++){var dt=yt[mt],ft=v[d.attachment][dt];if(Object.prototype.hasOwnProperty.call(Xe,dt)){var ht=Xe[dt].length;"number"==typeof ft.maximumNumber&&ht>ft.maximumNumber&&s("AttachmentMaximum: given number of attachments ("+ht+") doesn't satisfy specified maximum of "+ft.maximumNumber+' from type "'+dt+'"'+a+"."),(!ft.nullable||0!==ht)&&"number"==typeof ft.minimumNumber&&ht<ft.minimumNumber&&s("AttachmentMinimum: given number of attachments ("+ht+") doesn't satisfy specified minimum of "+ft.minimumNumber+' from type "'+dt+'"'+a+".");for(var gt,vt=0,bt=o(Xe[dt]);!(gt=bt()).done;){var Ot,wt,Pt=gt.value;if(null!=(Ot=ft.fileName)&&Ot.regularExpressionPattern){for(var jt,xt,Nt=[].concat(ft.fileName.regularExpressionPattern),At=!1,St=o(Nt);!(jt=St()).done;)if(xt=jt.value,new RegExp(xt).test(Pt)){At=!0;break}At||s('AttachmentName: given attachment name "'+Pt+'" doesn\'t satisfy one of specified regular expression patterns "'+Nt.join('", "')+'" from type "'+dt+'"'+a+".")}if(null!=(wt=ft.fileName)&&wt.invertedRegularExpressionPattern)for(var Ct,kt,Tt=o([].concat(ft.fileName.invertedRegularExpressionPattern));!(Ct=Tt()).done;)kt=Ct.value,new RegExp(kt).test(Pt)&&s('InvertedAttachmentName: given attachment name "'+Pt+'" does satisfy specified regular expression pattern "'+kt.toString()+'" from type "'+dt+'"'+a+".");if(Ie[Pt].content_type){if(ft.contentTypeRegularExpressionPattern){for(var Dt,Et,zt=[].concat(ft.contentTypeRegularExpressionPattern),Mt=!1,Rt=o(zt);!(Dt=Rt()).done;)if(Et=Dt.value,new RegExp(Et).test(Ie[Pt].content_type)){Mt=!0;break}Mt||s('AttachmentContentType: given attachment content type "'+Ie[Pt].content_type+'" doesn\'t satisfy specified regular expression pattern "'+zt.join('", "')+'" from type "'+dt+'"'+a+".")}var Ut=ft.invertedContentTypeRegularExpressionPattern;if(Ut)for(var _t,Ht,Lt=o([].concat(Ut));!(_t=Lt()).done;)Ht=_t.value,new RegExp(Ht).test(Ie[Pt].content_type)&&s('InvertedAttachmentContentType: given attachment content type "'+Ie[Pt].content_type+'" does satisfy specified regular expression pattern "'+Ht.toString()+'" from type "'+dt+'"'+a+".")}var It=0;"length"in Ie[Pt]?It=Ie[Pt].length:"data"in Ie[Pt]&&(It=Buffer&&"byteLength"in Buffer?Buffer.byteLength(Ie[Pt].data,"base64"):Ie[Pt].data.length),"number"==typeof ft.minimumSize&&ft.minimumSize>It?s("AttachmentMinimumSize: given attachment size "+It+" byte doesn't satisfy specified minimum of "+ft.minimumSize+" byte "+a+"."):"number"==typeof ft.maximumSize&&ft.maximumSize<It&&s("AttachmentMaximumSize: given attachment size "+It+" byte doesn't satisfy specified maximum of "+ft.maximumSize+" byte "+a+"."),vt+=It}"number"==typeof ft.minimumAggregatedSize&&ft.minimumAggregatedSize>vt?s('AttachmentAggregatedMinimumSize: given aggregated size of attachments from type "'+dt+'" '+vt+" byte doesn't satisfy specified minimum of "+ft.minimumAggregatedSize+" byte "+a+"."):"number"==typeof ft.maximumAggregatedSize&&ft.maximumAggregatedSize<vt&&s('AttachmentAggregatedMaximumSize: given aggregated size of attachments from type "'+dt+'" '+vt+" byte doesn't satisfy specified maximum of "+ft.maximumAggregatedSize+" byte "+a+"."),ut+=vt}}Object.prototype.hasOwnProperty.call(v,d.minimumAggregatedSize)&&"number"==typeof v[d.minimumAggregatedSize]&&v[d.minimumAggregatedSize]>ut?s("AggregatedMinimumSize: given aggregated size "+ut+" byte doesn't satisfy specified minimum of "+v[d.minimumAggregatedSize]+" byte "+a+"."):"number"==typeof v[d.maximumAggregatedSize]&&v[d.maximumAggregatedSize]<ut&&s("AggregatedMaximumSize: given aggregated size "+ut+" byte doesn't satisfy specified maximum of "+v[d.maximumAggregatedSize]+" byte "+a+".")}if(r&&Object.prototype.hasOwnProperty.call(r,d.attachment)&&0===Object.keys(r[d.attachment]).length&&delete r[d.attachment],0===i.length&&r&&"migrate"===w)for(var Vt,Wt=0,Ft=Object.keys(r);Wt<Ft.length;Wt++)Vt=Ft[Wt],Object.prototype.hasOwnProperty.call(e,Vt)||(i=n.concat(Vt,"migrate removed property"));return{changedPath:i,newDocument:e}},I={attachmentWithPrefixExists:function(t){if(Object.prototype.hasOwnProperty.call(e,d.attachment)){var r=e[d.attachment],n=_(t);if(n)return Object.prototype.hasOwnProperty.call(r[n],"stub")&&r[n].stub||Object.prototype.hasOwnProperty.call(r[n],"data")&&![null,void 0].includes(r[n].data)}return!1},checkDocument:L,getFileNameByPrefix:_,serialize:z,id:v,revision:b,idName:f,revisionName:h,specialNames:d,typeName:g,modelConfiguration:l,models:c,now:u,nowUTCTimestamp:m,securitySettings:i,userContext:a};if(e[d.attachment])for(var V,W=0,F=Object.values(e[d.attachment]);W<F.length;W++)V=F[W],Object.prototype.hasOwnProperty.call(V,"contentType")&&(V.content_type=V.contentType,delete V.contentType);var B=L(e,r);return(!B.newDocument._deleted||r)&&(B.newDocument._deleted&&B.newDocument._deleted!==(null==r?void 0:r._deleted)||B.changedPath.length)||s("NoChange: No new data given. new document: "+z(e)+"; old document: "+z(r)+"."),Object.prototype.hasOwnProperty.call(i,l.property.name.validatedDocumentsCache)?i[l.property.name.validatedDocumentsCache].add(v+"-"+b):i[l.property.name.validatedDocumentsCache]=new Set([v+"-"+b]),B.newDocument},e}(),p=c;e.exports=l}()}],t={};var r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(0);module.exports=r})();(()=>{var e=[e=>{!function(){"use strict";function t(){return(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var a=new(Function.bind.apply(e,o));return n&&r(a,n.prototype),a}).apply(null,arguments)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var i={d:function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},l={};i.r(l),i.d(l,{DatabaseHelper:function(){return c},default:function(){return p}});var c=function(){function e(){}return e.authenticate=function(e,t,r,n,a,i,l,c,p){var s;void 0===t&&(t=null),void 0===r&&(r={}),void 0===n&&(n={admins:{names:[],roles:[]},members:{names:[],roles:[]}}),void 0===i&&(i="_id"),void 0===l&&(l="-type"),void 0===c&&(c="_design/"),void 0===p&&(p=!1);var u=null!==(s=e[l])&&void 0!==s?s:t&&t[l];if(!u)return!0;var m=p?"read":"write",y={properties:{},read:["_admin","readonlyadmin"],write:["_admin"]};Object.prototype.hasOwnProperty.call(e,i)&&e[i].startsWith(c)&&y.read.push("readonlymember");var d,f="Current user doesn't own any role";if(r)if("name"in r||(r.name='"unknown"'),null!=(d=r.roles)&&d.length){if(a&&u&&Object.prototype.hasOwnProperty.call(a,u)){for(var h,g,v=a[u],b=o(["read","write"]);!(h=b()).done;)y[g=h.value]=y[g].concat(v[g]||[]);y.properties=v.properties}for(var O,w,P=y[m],j=o(r.roles);!(O=j()).done;)if(w=O.value,P.includes(w))return!0;f='Current user "'+r.name+'" owns the following roles: "'+r.roles.join('", "')+'"'}else f='Current user "'+r.name+"\" doesn't own any role";throw{unauthorized:"Only users with a least on of these roles are allowed to perform requested "+m+' action: "'+[].concat(y[m]).join('", "')+'". '+f+"."}},e.validateDocumentUpdate=function(e,r,a,i,l,c,p){void 0===c&&(c={});var s=function(e,t,r){var o;throw void 0===t&&(t="forbidden"),void 0===r&&(r={}),n(((o={})[t]=e,o.message=e,o.name=t,o),r)},u=new Date,m=Date.UTC(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())/1e3,y=!l.dateTimeFormat.startsWith("iso"),d=l.property.name.special,f=d.id,h=d.revision,g=d.type;r&&r[g]&&!e[g]&&(e[g]=r[g]);var v="",b="",O=function(){v=Object.prototype.hasOwnProperty.call(e,f)?e[f]:"",b=Object.prototype.hasOwnProperty.call(e,h)?e[h]:""};if(O(),Object.prototype.hasOwnProperty.call(i,l.property.name.validatedDocumentsCache)&&i[l.property.name.validatedDocumentsCache].has(v+"-"+b))return i[l.property.name.validatedDocumentsCache].delete(v+"-"+b),e;["latest","upsert"].includes(b)&&(r&&Object.prototype.hasOwnProperty.call(r,h)?b=e[h]=r[h]:"latest"===b?s("Revision: No old document available to update."):delete e[h]);var w=l.updateStrategy;Object.prototype.hasOwnProperty.call(e,d.strategy)&&(w=e[d.strategy],delete e[d.strategy]);var P,j={};if("migrate"===w)for(var x=0,N=Object.entries(c);x<N.length;x++){var A=N[x],S=A[0],C=A[1];if(Object.prototype.hasOwnProperty.call(C,d.oldType)&&C[d.oldType])for(var k,T,D=o([].concat(C[d.oldType]));!(k=D()).done;)T=k.value,j[T]=S}p?P=p:JSON&&Object.prototype.hasOwnProperty.call(JSON,"stringify")?P=function(e){return JSON.stringify(e,null,4)}:s('Needed "serializer" is not available.');var E=[d.additional,d.allowedRole,d.constraint.execution,d.constraint.expression,d.create.execution,d.create.expression,d.extend,d.maximumAggregatedSize,d.minimumAggregatedSize,d.oldType,d.update.execution,d.update.expression],z=function(e){return e instanceof Error?""+e:P(e)},M=function(e){return"string"==typeof e?e.trim():""},R=function(e){if(y)null!==e&&"number"!=typeof e&&(e=new Date(e),e=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())/1e3);else if(null!==e){e=new Date("number"!=typeof e||isNaN(e)?e:1e3*e);try{e=e.toISOString()}catch(e){}}return e},U=function(e,t,r){if(r.fileName){if(r.fileName.value)return r.fileName.value===t;if(r.fileName.regularExpressionPattern)return[].concat(r.fileName.regularExpressionPattern).some((function(e){return new RegExp(e).test(t)}))}return e===t},_=function(t,r){if(r||(r=e[d.attachment]),t){for(var n,o=0,a=Object.keys(r);o<a.length;o++)if((n=a[o]).startsWith(t))return n}else{var i=Object.keys(r);if(i.length)return i[0]}return null},H=function(e,r,o){void 0===r&&(r=!1),void 0===o&&(o={});var a=M(e);if(a){var i,l=(r?"return ":"")+a,c=n({},I,{code:l},o),p=Object.keys(c);try{i=t(Function,p.concat([l]))}catch(i){s(z(i),"compilation",{code:l,error:i,scope:c})}var u={code:l,result:void 0,scope:c};try{u.result=i.apply(void 0,p.map((function(e){return c[e]})))}catch(i){s(z(i),"runtime",{code:l,error:i,scope:c})}return u}s("No expression to evaluate provided.","empty")},L=function(e,r,n){void 0===n&&(n=[]);var a=n.length?" in "+n.join(" -> "):"",i=[],p=function(){Object.prototype.hasOwnProperty.call(e,g)||(r&&Object.prototype.hasOwnProperty.call(r,g)&&["fillUp","migrate"].includes(w)?e[g]=r[g]:s('Type: You have to specify a model type via property "'+g+'"'+a+".")),n.length||new RegExp(l.property.name.typeRegularExpressionPattern.public).test(e[g])||s('TypeName: You have to specify a model type which matches "'+l.property.name.typeRegularExpressionPattern.public+'" as public type (given "'+e[g]+'")'+a+"."),Object.prototype.hasOwnProperty.call(c,e[g])||(Object.prototype.hasOwnProperty.call(j,e[g])?e[g]=j[e[g]]:s('Model: Given model "'+e[g]+'" is not specified'+a+"."))};p();var u,m=e[g],v=c[m];Object.prototype.hasOwnProperty.call(v,d.additional)&&v[d.additional]&&(u=v[d.additional]);var b=function(i,l,c,p,u){void 0===u&&(u=["constraintExecution","constraintExpression"]);for(var y,d,f=o(u);!(y=f()).done;)if(d=y.value,Object.prototype.hasOwnProperty.call(c,d)){var h=void 0;try{h=H(c[d].evaluation,d.endsWith("Expression"),{checkPropertyContent:P,model:v,modelName:m,name:l,type:d,newDocument:e,newValue:i,oldDocument:r,oldValue:p,parentNames:n,pathDescription:a,propertySpecification:c})}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+d+'" has invalid code "'+e.code+'": "'+e.message+'"'+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+d+'" has throw an error with code "'+e.code+'": "'+e.message+'"'+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}if(h&&!h.result){var g=M(c[d].description);s(d.charAt(0).toUpperCase()+(d.substring(1)+": ")+(g?t(Function,Object.keys(h.scope).concat(["return "+g])).apply(void 0,Object.values(h.scope)):'Property "'+l+'" should satisfy constraint "'+h.code+'" (given "'+z(i)+'")'+a+"."))}}},P=function(e,t,r,i){var l=[],p=[].concat(r.type?r.type:[]);"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&!Object.prototype.hasOwnProperty.call(e,g)&&1===p.length&&Object.prototype.hasOwnProperty.call(c,p[0])&&(e[g]=p[0]);for(var u,m,d=!1,h=o(p);!(u=h()).done;)if(m=u.value,Object.prototype.hasOwnProperty.call(c,m)){if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,g)&&e[g]!==m&&"migrate"===w&&1===p.length&&(e[g]=m,l=n.concat(t+"","migrate nested object type")),"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,g)&&e[g]===m){var v=L(e,i,n.concat(t+""));if(v.changedPath.length&&(l=v.changedPath),e=v.newDocument,z(e)===z({}))return{newValue:void 0,changedPath:l};d=!0;break}1===p.length&&s('NestedType: Under key "'+t+'" isn\'t of type "'+m+'" (given "'+z(e)+'" of type '+typeof e+")"+a+".")}else if("DateTime"===m){var O=e;if(e=R(e),!(y&&("number"!=typeof e||isNaN(e))||!y&&"string"!=typeof e)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t of (valid) type "DateTime" (given"'+z(O).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof O+'")'+a+".")}else if(["boolean","integer","number","string"].includes(m)){if(!("number"==typeof e&&isNaN(e)||"integer"!==m&&typeof e!==m||"integer"===m&&parseInt(e,10)!==e)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t of (valid) type "'+m+'" (given "'+z(e)+'" of type "'+typeof e+'")'+a+".")}else if("string"==typeof m&&m.startsWith("foreignKey:")){var P=c[m.substring(11)][f].type;if(P===typeof e){d=!0;break}1===p.length&&s('PropertyType: Foreign key property "'+t+'" isn\'t of type "'+P+'" (given "'+z(e)+'" of type "'+typeof e+'")'+a+".")}else{if("any"===m||z(e)===z(m)){d=!0;break}1===p.length&&s('PropertyType: Property "'+t+'" isn\'t value "'+m+'" (given "'+z(e).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof e+'")'+a+".")}if(d||s('PropertyType: None of the specified types "'+p.join('", "')+'" for property "'+t+'" matches value "'+z(e).replace(/^"/,"").replace(/"$/,"")+e+'" of type "'+typeof e+'")'+a+"."),"string"==typeof e&&("number"==typeof r.minimumLength&&e.length<r.minimumLength&&s('MinimalLength: Property "'+t+'" must have minimal length '+r.minimumLength+" (given "+e+" with length "+e.length+") "+a+"."),"number"==typeof r.maximumLength&&e.length>r.maximumLength&&s('MaximalLength: Property "'+t+'" must have maximal length '+r.maximumLength+" (given "+e+" with length "+e.length+")"+a+".")),"number"==typeof e&&("number"==typeof r.minimum&&e<r.minimum&&s('Minimum: Property "'+t+'" (type '+r.type+") must satisfy a minimum of "+r.minimum+" (given "+e+" is too low)"+a+"."),"number"==typeof r.maximum&&e>r.maximum&&s('Maximum: Property "'+t+'" (type '+r.type+") must satisfy a maximum of "+r.maximum+" (given "+e+" is too high)"+a+".")),r.selection){var j=Array.isArray(r.selection)?r.selection.map((function(e){return void 0===(null==e?void 0:e.value)?e:e.value})):Object.keys(r.selection);"DateTime"===r.type&&(j=j.map(R)),j.includes(e)||s('Selection: Property "'+t+'" (type '+r.type+') should be one of "'+j.join('", "')+'". But is "'+e+'"'+a+".")}if(r.regularExpressionPattern){for(var x,N,A=[].concat(r.regularExpressionPattern),S=!1,C=o(A);!(x=C()).done;)if(N=x.value,new RegExp(N).test(e)){S=!0;break}S||s('PatternMatch: Property "'+t+'" should match one regular expression pattern "'+A.join('", "')+'" (given "'+e+'")'+a+".")}if(r.invertedRegularExpressionPattern)for(var k,T,D=o([].concat(r.invertedRegularExpressionPattern));!(k=D()).done;)T=k.value,new RegExp(T).test(e)&&s('InvertedPatternMatch: Property "'+t+'" should not match regular expression pattern '+T+' (given "'+e+'")'+a+".");return b(e,t,r,i),z(e)!==z(i)&&(l=n.concat(t+"","value updated")),{newValue:e,changedPath:l}},x=function(e,t,r,o,a){var c=t[o];if(!e.writable)if(r){if(Object.prototype.hasOwnProperty.call(r,o)&&z(c)===z(r[o]))return o!==f&&"incremental"===w&&delete t[o],!0;s('Readonly: Property "'+o+'" is not writable (old document "'+z(r)+'")'+a+".")}else s('Readonly: Property "'+o+'" is not writable'+a+".");if(!e.mutable&&r&&Object.prototype.hasOwnProperty.call(r,o)){if(z(c)===z(r[o]))return"incremental"!==w||l.property.name.reserved.concat(d.deleted,f,h).includes(o+"")||delete t[o],!0;"migrate"!==w&&s('Immutable: Property "'+o+'"is not writable (old document "'+z(r)+'")'+a+".")}if(null===c){if(e.nullable)return"incremental"===w&&r&&void 0!==r[o]||delete t[o],r&&Object.prototype.hasOwnProperty.call(r,o)&&(i=n.concat(o+"","delete property")),!0;s('NotNull: Property "'+o+'" should not be "null"'+a+".")}return!1},N=function(e,t,r,i,l){if(!r)for(var c,p,u=o(["onCreateExecution","onCreateExpression"]);!(c=u()).done;)if(p=c.value,Object.prototype.hasOwnProperty.call(e,p)){var y=void 0;try{y=H(e[p],p.endsWith("Expression"),{attachmentsTarget:l,checkPropertyContent:P,model:v,modelName:m,name:i+"",type:p,newDocument:t,oldDocument:r,newValue:void 0,oldValue:void 0,parentNames:n,pathDescription:a,propertySpecification:e})}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+p+'" has invalid code "'+e.code+'" for property "'+i+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+p+'" has throw an error with code "'+e.code+'" for property "'+i+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}y&&![null,void 0].includes(y.result)&&(l?l[i]=y.result:t[i]=y.result)}},A=function(e,t,r,i,l){if(!l){if(!Object.prototype.hasOwnProperty.call(t,i))return;e.trim&&"string"==typeof t[i]&&(t[i]=t[i].trim()),e.emptyEqualsNull&&(""===t[i]||Array.isArray(t[i])&&0===t[i].length||null!==t[i]&&"object"==typeof t[i]&&0===Object.keys(t).length)&&(t[i]=null)}for(var c,p,u=o(["onUpdateExecution","onUpdateExpression"]);!(c=u()).done;)if(p=c.value,Object.prototype.hasOwnProperty.call(e,p))try{var y=H(e[p],p.endsWith("Expression"),{attachmentsTarget:l,checkPropertyContent:P,model:v,modelName:m,name:i+"",type:p,newDocument:t,oldDocument:r,newValue:t[i],oldValue:r&&r[i]||void 0,parentNames:n,pathDescription:a,propertySpecification:e});l?l[i]=y.result:t[i]=y.result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+p+'" has invalid code "'+e.code+'" for property "'+i+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+p+'" has throw an error with code "'+e.code+'" for property "'+i+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}},S=Object.keys(v).filter((function(e){return!E.includes(e)}));if("migrate"===w)for(var C,k,T=o(S);!(C=T()).done;)if(k=C.value,v[k].oldName)for(var D,_,I=o([].concat(v[k].oldName));!(D=I()).done;)_=D.value,Object.prototype.hasOwnProperty.call(e,_)&&(e[k]=e[_],delete e[_]);if(!r)for(var V,W=0,F=[d.create.execution,d.create.expression];W<F.length;W++)if(V=F[W],Object.prototype.hasOwnProperty.call(v,V)){var B=void 0;try{B=H(v[V],V.endsWith("Expression"),{checkPropertyContent:P,model:v,modelName:m,type:V,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a}).result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+V+'" has invalid code "'+e.code+'" for document "'+m+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&s('Runtime: Hook "'+V+'" has throw an error with code "'+e.code+'" for document "'+m+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}[null,void 0].includes(B)||(e=B),p(),m=e[g],0===n.length&&O()}for(var q,Y=0,$=[d.update.execution,d.update.expression];Y<$.length;Y++)if(q=$[Y],Object.prototype.hasOwnProperty.call(v,q)){var J=void 0;try{J=H(v[q],q.endsWith("Expression"),{checkPropertyContent:P,model:v,modelName:m,type:q,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a}).result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&s('Compilation: Hook "'+q+'" has invalid code "'+e.code+'" for document "'+