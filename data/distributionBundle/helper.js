(()=>{var e=[e=>{"use strict";e.exports=require("@babel/runtime/helpers/extends")},e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},e=>{"use strict";e.exports=require("clientnode")},(e,t,r)=>{!function(){"use strict";function t(e){var r=o[e];if(void 0!==r)return r.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,t),a.exports}var n=[,function(e){e.exports=r(0)},function(e){e.exports=r(1)},function(e){e.exports=r(2)},function(e){e.exports=r(3)}],o={};t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,{a:r}),r},t.d=function(e,r){for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(function(){function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}t.r(a),t.d(a,{determineAllowedModelRolesMapping:function(){return v},determineGenericIndexablePropertyNames:function(){return x},ensureValidationDocumentPresence:function(){return y},extendModel:function(){return m},extendModels:function(){return g},getConnectorOptions:function(){return d},initializeConnection:function(){return b},isPropertySpecification:function(){return h},mayStripRepresentation:function(){return f},normalizeAllowedRoles:function(){return w}});var n=t(1),o=t.n(n),i=t(2),c=t.n(i),s=t(3),u=t.n(s),p=t(4),l=t.n(p),d=function(e){return e.couchdb.connector.fetch?{fetch:function(t,r){return p.globalContext.fetch(t,l().extend(!0,l().copy(e.couchdb.connector.fetch),r||{}))}}:{fetch:function(e,t){return p.globalContext.fetch(e,t)}}},f=function(e,t,r){var n=l().represent(e);return n.length<=t?n.length>r?n.substring(0,r-3)+"...":n:"DOCUMENT IS TOO BIG TO REPRESENT"},y=function(){var e=c()(u().mark((function e(t,r,n,a,i,c,s,p){var d,f,y;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i=!0),void 0===c&&(c="_id"),void 0===s&&(s="_rev"),void 0===p&&(p="_design/"),f=o()(((d={})[c]=""+p+r,d.language="javascript",d.version="1.0.634",d),n),e.prev=5,e.next=8,t.get(""+p+r);case 8:return y=e.sent,f[s]=y[s],e.next=12,t.put(f);case 12:i&&console.info(a+" updated."),e.next=27;break;case 15:return e.prev=15,e.t0=e.catch(5),i&&("not_found"===e.t0.error?console.info(a+" not available: create new one."):console.info(a+" couldn't be updated: \""+l().represent(e.t0)+'" create new one.')),e.prev=18,e.next=21,t.put(f);case 21:i&&console.info(a+" installed/updated."),e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(18),new Error(a+" couldn't be installed/updated: \""+l().represent(e.t1)+'".');case 27:case"end":return e.stop()}}),e,null,[[5,15],[18,24]])})));return function(){return e.apply(this,arguments)}}(),b=function(){var t=c()(u().mark((function t(r,n){var o,a,i,s,f,y,b,v;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=n.couchdb,a=l().stringFormat(o.url,o.user.name+":"+o.user.password+"@")+"/"+o.databaseName,r.couchdb.connection=new r.couchdb.connector(a,d(n)),(i=r.couchdb.connection).setMaxListeners(1/0),s=o.model.property.name.special.id,f=o.model.property.name.special.revision,y=u().mark((function(){var e,t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e=v.value,t=i[e].bind(i),i[e]=c()(u().mark((function e(r){var n,a,i,c,p,l,d,y=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=y.length,a=Array(1<n?n-1:0),i=1;i<n;i++)a[i-1]=y[i];return c=a.length&&"object"==typeof a[0]?a[0]:{},e.prev=2,e.next=5,t.apply(void 0,[r].concat(a));case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),p=r[s],l=e.t0,!(p&&o.ignoreNoChangeError&&"name"in l&&"forbidden"===l.name&&"message"in l&&l.message.startsWith("NoChange:"))){e.next=25;break}if(d=f in c?c[f]:r[f],e.t1=p,!(f in r)||["latest","upsert"].includes(d)){e.next=19;break}e.t2=d,e.next=23;break;case 19:return e.next=21,this.get(p);case 21:e.t3=f,e.t2=e.sent[e.t3];case 23:return e.t4=e.t2,e.abrupt("return",{id:e.t1,rev:e.t4,ok:!0});case 25:throw l;case 26:case"end":return e.stop()}}),e,this,[[2,8]])})));case 3:case"end":return r.stop()}}),y)})),b=e(["post","put"]);case 9:if((v=b()).done){t.next=13;break}return t.delegateYield(y(),"t0",11);case 11:t.next=9;break;case 13:return t.prev=13,t.next=16,l().checkReachability(a);case 16:t.next=23;break;case 18:return t.prev=18,t.t1=t.catch(13),console.info("Database could not be retrieved yet: Creating it."),t.next=23,p.globalContext.fetch(a,{method:"PUT"});case 23:return t.abrupt("return",r);case 24:case"end":return t.stop()}}),t,null,[[13,18]])})));return function(){return t.apply(this,arguments)}}(),v=function(e){for(var t=e.property.name.special.allowedRole,r={},n=g(e),a=0,i=Object.entries(n);a<i.length;a++){var c=i[a],s=c[0],u=c[1];if(Object.prototype.hasOwnProperty.call(u,t)){r[s]=o()({properties:{}},w(u[t]));for(var p=0,l=Object.entries(u);p<l.length;p++){var d=l[p],f=d[0],y=d[1];null!==y&&"object"==typeof y&&y.allowedRoles&&(r[s].properties[f]=w(y.allowedRoles))}}else r[s]={properties:{},read:[],write:[]}}return r},h=function(e){return null!==e&&"object"==typeof e},x=function(e,t){var r=e.property.name.special;return Object.keys(t).filter((function(n){var o=t[n];return h(o)&&Object.prototype.hasOwnProperty.call(o,"index")&&o.index||h(o)&&!(Object.prototype.hasOwnProperty.call(o,"index")&&!o.index||e.property.name.reserved.concat(r.additional,r.allowedRole,r.attachment,r.conflict,r.constraint.execution,r.constraint.expression,r.deleted,r.deletedConflict,r.extend,r.maximumAggregatedSize,r.minimumAggregatedSize,r.oldType,r.id,r.revision,r.revisions,r.revisionsInformation,r.type).includes(n)||o.type&&("string"==typeof o.type&&o.type.endsWith("[]")||Array.isArray(o.type)&&o.type.length&&Array.isArray(o.type[0])||Object.prototype.hasOwnProperty.call(e.entities,o.type)))})).concat([r.id,r.revision]).sort()},m=function(t,r,n){if(void 0===n&&(n="_extends"),"_base"===t)return r[t];if(Object.prototype.hasOwnProperty.call(r,"_base")&&(Object.prototype.hasOwnProperty.call(r[t],n)&&r[t][n]?r[t][n]=["_base"].concat(r[t][n]):r[t][n]="_base"),Object.prototype.hasOwnProperty.call(r[t],n)){for(var o,a,i=e([].concat(r[t][n]));!(o=i()).done;)a=o.value,r[t]=l().extend(!0,l().copy(m(a,r,n)),r[t]);delete r[t][n]}return r[t]},g=function(e){for(var t,r=e.property.name.special,n={},o=e.property.name.typeRegularExpressionPattern,a=0,i=Object.keys(e.entities);a<i.length;a++){if(t=i[a],!new RegExp(o.public).test(t)&&!new RegExp(o.private).test(t))throw new Error('Model names have to match "'+o.public+'" or "'+o.private+'" for private one (given name: "'+t+'").');n[t]=m(t,e.entities,r.extend)}for(var c,s=0,u=Object.values(n);s<u.length;s++){c=u[s];for(var p=0,d=Object.entries(c);p<d.length;p++){var f=d[p],y=f[0],b=f[1];if(y===r.attachment)for(var v=b,h=0,x=Object.entries(v);h<x.length;h++){var g=x[h],w=g[0],O=g[1];v[w]=l().extend(!0,l().copy(e.property.defaultSpecification),O)}else[r.allowedRole,r.constraint.execution,r.constraint.expression,r.extend,r.maximumAggregatedSize,r.minimumAggregatedSize,r.oldType].includes(y)||(c[y]=l().extend(!0,l().copy(e.property.defaultSpecification),b))}}return n},w=function(e){if(Array.isArray(e))return{read:e,write:e};if("object"==typeof e){for(var t,r={read:[],write:[]},n=0,o=Object.keys(r);n<o.length;n++)t=o[n],Object.prototype.hasOwnProperty.call(e,t)&&(Array.isArray(e[t])?r[t]=e[t]:r[t]=[e[t]]);return r}return{read:[e],write:[e]}}})(),e.exports=a}()}],t={};var r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(4);module.exports=r})();