(()=>{var __webpack_modules__=[e=>{"use strict";e.exports=require("@babel/runtime/helpers/extends")},e=>{"use strict";e.exports=require("@babel/runtime/helpers/asyncToGenerator")},e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},e=>{"use strict";e.exports=require("child_process")},e=>{"use strict";e.exports=require("clientnode")},e=>{"use strict";e.exports=require("pouchdb/node_modules/node-fetch/lib/index.js")},e=>{"use strict";e.exports=require("fs")},e=>{"use strict";e.exports=require("path")},,(module,__unused_webpack_exports,__webpack_require__)=>{(function(){function __nested_webpack_require_12__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__nested_webpack_require_12__),r.exports}var __webpack_modules__=[function(e){"use strict";e.exports=__webpack_require__(0)},function(e){"use strict";e.exports=__webpack_require__(1)},function(e){"use strict";e.exports=__webpack_require__(2)},function(e){"use strict";e.exports=__webpack_require__(3)},function(e){"use strict";e.exports=__webpack_require__(4)},function(e){"use strict";e.exports=__webpack_require__(5)},function(e){"use strict";e.exports=__webpack_require__(6)},function(e){"use strict";e.exports=__webpack_require__(7)},function(__unused_webpack_module,__webpack_exports__,__nested_webpack_require_859__){"use strict";function _createForOfIteratorHelperLoose(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}__nested_webpack_require_859__.d(__webpack_exports__,{default:function(){return __WEBPACK_DEFAULT_EXPORT__}});var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__=__nested_webpack_require_859__(0),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default=__nested_webpack_require_859__.n(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__nested_webpack_require_859__(1),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default=__nested_webpack_require_859__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__=__nested_webpack_require_859__(2),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default=__nested_webpack_require_859__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__),child_process__WEBPACK_IMPORTED_MODULE_3__=__nested_webpack_require_859__(3),child_process__WEBPACK_IMPORTED_MODULE_3___default=__nested_webpack_require_859__.n(child_process__WEBPACK_IMPORTED_MODULE_3__),clientnode__WEBPACK_IMPORTED_MODULE_4__=__nested_webpack_require_859__(4),clientnode__WEBPACK_IMPORTED_MODULE_4___default=__nested_webpack_require_859__.n(clientnode__WEBPACK_IMPORTED_MODULE_4__),node_fetch__WEBPACK_IMPORTED_MODULE_5__=__nested_webpack_require_859__(5),node_fetch__WEBPACK_IMPORTED_MODULE_5___default=__nested_webpack_require_859__.n(node_fetch__WEBPACK_IMPORTED_MODULE_5__),fs__WEBPACK_IMPORTED_MODULE_6__=__nested_webpack_require_859__(6),fs__WEBPACK_IMPORTED_MODULE_6___default=__nested_webpack_require_859__.n(fs__WEBPACK_IMPORTED_MODULE_6__),path__WEBPACK_IMPORTED_MODULE_7__=__nested_webpack_require_859__(7),path__WEBPACK_IMPORTED_MODULE_7___default=__nested_webpack_require_859__.n(path__WEBPACK_IMPORTED_MODULE_7__);clientnode__WEBPACK_IMPORTED_MODULE_4__.globalContext.fetch=node_fetch__WEBPACK_IMPORTED_MODULE_5___default();var Helper=function(){function Helper(){}return Helper.getConnectorOptions=function(e){return e.couchdb.connector.fetch?{fetch:function(t,r){return clientnode__WEBPACK_IMPORTED_MODULE_4__.globalContext.fetch(t,clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(e.couchdb.connector.fetch),r||{}))}}:{fetch:function(e,t){return clientnode__WEBPACK_IMPORTED_MODULE_4__.globalContext.fetch(e,t)}}},Helper.mayStripRepresentation=function(e,t,r){var n=clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(e);return n.length<=t?n.length>r?n.substring(0,r-3)+"...":n:"DOCUMENT IS TOO BIG TO REPRESENT"},Helper.ensureValidationDocumentPresence=(a=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(t,r,n,a,o,c,i){var s,l,u;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===o&&(o=!0),void 0===c&&(c="_id"),void 0===i&&(i="_design/"),l=_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()(((s={})[c]=""+i+r,s.language="javascript",s),n),e.prev=4,e.next=7,t.get(""+i+r);case 7:return u=e.sent,l._rev=u._rev,e.next=11,t.put(l);case 11:case 20:e.next=26;break;case 14:return e.prev=14,e.t0=e.catch(4),o&&e.t0.error,e.prev=17,e.next=20,t.put(l);case 23:throw e.prev=23,e.t1=e.catch(17),new Error(a+" couldn't be installed/updated: \""+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(e.t1)+'".');case 26:case"end":return e.stop()}}),e,null,[[4,14],[17,23]])}))),function(){return a.apply(this,arguments)}),Helper.initializeConnection=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(t,r){var n,a,o,c,i,s;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringFormat(r.couchdb.url,r.couchdb.user.name+":"+r.couchdb.user.password+"@")+"/"+r.couchdb.databaseName,t.couchdb.connection=new t.couchdb.connector(n,Helper.getConnectorOptions(r)),t.couchdb.connection.setMaxListeners(1/0),a=r.couchdb.model.property.name.special.id,o=r.couchdb.model.property.name.special.revision,c=function(){var e=s.value,n=t.couchdb.connection[e].bind(t.couchdb.connection);t.couchdb.connection[e]=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(t){var c,i,s,l,u,p=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,c=p.length,i=Array(1<c?c-1:0),s=1;s<c;s++)i[s-1]=p[s];return e.next=4,n.apply(void 0,[t].concat(i));case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(0),!(a in t&&r.couchdb.ignoreNoChangeError&&"forbidden"===e.t0.name&&null!=(l=e.t0.message)&&l.startsWith("NoChange:"))){e.next=21;break}if(u={id:t[a],ok:!0},!(o in t)||["latest","upsert"].includes(t[o])){e.next=15;break}e.t1=t[o],e.next=19;break;case 15:return e.next=17,this.get(u.id);case 17:e.t2=o,e.t1=e.sent[e.t2];case 19:return u.rev=e.t1,e.abrupt("return",u);case 21:throw e.t0;case 22:case"end":return e.stop()}}),e,this,[[0,7]])})))},i=_createForOfIteratorHelperLoose(["post","put"]);!(s=i()).done;)c();return e.prev=7,e.next=10,clientnode__WEBPACK_IMPORTED_MODULE_4___default().checkReachability(n);case 10:e.next=17;break;case 12:return e.prev=12,e.t0=e.catch(7),e.next=17,clientnode__WEBPACK_IMPORTED_MODULE_4__.globalContext.fetch(n,{method:"PUT"});case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,null,[[7,12]])})));return function(){return e.apply(this,arguments)}}(),Helper.startServer=function(){function startServer(){return _startServer.apply(this,arguments)}var _startServer=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _callee4(services,configuration){var _this=this;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!Object.prototype.hasOwnProperty.call(services.couchdb.server.runner,"configurationFile")){_context4.next=12;break}return _context4.prev=1,_context4.next=4,fs__WEBPACK_IMPORTED_MODULE_6__.promises.mkdir(path__WEBPACK_IMPORTED_MODULE_7___default().dirname(services.couchdb.server.runner.configurationFile.path),{recursive:!0});case 4:_context4.next=10;break;case 6:if(_context4.prev=6,_context4.t0=_context4.catch(1),"EEXIST"===_context4.t0.code){_context4.next=10;break}throw _context4.t0;case 10:return _context4.next=12,fs__WEBPACK_IMPORTED_MODULE_6__.promises.writeFile(services.couchdb.server.runner.configurationFile.path,services.couchdb.server.runner.configurationFile.content,{encoding:configuration.core.encoding});case 12:return services.couchdb.server.process=(0,child_process__WEBPACK_IMPORTED_MODULE_3__.spawn)("default"===configuration.couchdb.binary.memoryInMegaByte?services.couchdb.server.runner.binaryFilePath:configuration.couchdb.binary.nodePath,("default"===configuration.couchdb.binary.memoryInMegaByte?[]:["--max-old-space-size="+configuration.couchdb.binary.memoryInMegaByte,services.couchdb.server.runner.binaryFilePath]).concat(services.couchdb.server.runner.arguments?services.couchdb.server.runner.arguments:[]),{cwd:eval("process").cwd(),env:Object.prototype.hasOwnProperty.call(services.couchdb.server.runner,"environment")?_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},eval("process").env,services.couchdb.server.runner.environment):eval("process").env,shell:!0,stdio:"inherit"}),new Promise((function(e,t){for(var r,n,a=_createForOfIteratorHelperLoose(clientnode__WEBPACK_IMPORTED_MODULE_4__.CloseEventNames);!(r=a()).done;)n=r.value,services.couchdb.server.process.on(n,clientnode__WEBPACK_IMPORTED_MODULE_4___default().getProcessCloseHandler(e,t,{process:services.couchdb.server.process,reason:n}))})).then((function(e){var t,r;null!=(t=services.couchdb)&&null!=(r=t.server)&&r.resolve&&services.couchdb.server.resolve.call(_this,e)}),(function(e){var t,r;null!=(t=services.couchdb)&&null!=(r=t.server)&&r.resolve&&services.couchdb.server.reject.call(_this,e)})),_context4.next=16,clientnode__WEBPACK_IMPORTED_MODULE_4___default().checkReachability(clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringFormat(configuration.couchdb.url,""),{wait:!0});case 16:case"end":return _context4.stop()}}),_callee4,null,[[1,6]])})));return startServer}(),Helper.restartServer=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(t,r,n,a){var o,c;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.couchdb.server.resolve,c=t.couchdb.server.reject,t.couchdb.server.resolve=t.couchdb.server.reject=clientnode__WEBPACK_IMPORTED_MODULE_4___default().noop,e.next=5,Helper.stopServer(t,r);case 5:return t.couchdb.server.resolve=o,t.couchdb.server.reject=c,e.next=9,Helper.startServer(t,r);case 9:return Helper.initializeConnection(t,r),e.next=12,a.callStack("restartCouchdb",n,r,t);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Helper.stopServer=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(t,r){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.couchdb.connection&&t.couchdb.connection.close(),t.couchdb.server.process&&t.couchdb.server.process.kill("SIGINT"),e.next=4,clientnode__WEBPACK_IMPORTED_MODULE_4___default().checkUnreachability(clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringFormat(r.couchdb.url,""),{wait:!0});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Helper.determineAllowedModelRolesMapping=function(e){for(var t=e.property.name.special.allowedRoles,r={},n=Helper.extendModels(e),a=0,o=Object.entries(n);a<o.length;a++){var c=o[a],i=c[0],s=c[1];if(Object.prototype.hasOwnProperty.call(s,t)){r[i]=_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({properties:{}},Helper.normalizeAllowedRoles(s[t]));for(var l=0,u=Object.entries(s);l<u.length;l++){var p=u[l],_=p[0],d=p[1];null!==d&&"object"==typeof d&&d.allowedRoles&&(r[i].properties[_]=Helper.normalizeAllowedRoles(d.allowedRoles))}}else r[i]={properties:{},read:[],write:[]}}return r},Helper.determineGenericIndexablePropertyNames=function(e,t){var r=e.property.name.special;return Object.keys(t).filter((function(n){return null!==t[n]&&"object"==typeof t[n]&&(Object.prototype.hasOwnProperty.call(t[n],"index")&&t[n].index||!(Object.prototype.hasOwnProperty.call(t[n],"index")&&!t[n].index||e.property.name.reserved.concat(r.additional,r.allowedRoles,r.attachment,r.conflict,r.constraint.execution,r.constraint.expression,r.deleted,r.deletedConflict,r.extend,r.id,r.maximumAggregatedSize,r.minimumAggregatedSize,r.oldType,r.revision,r.revisions,r.revisionsInformation,r.type).includes(n)||t[n].type&&("string"==typeof t[n].type&&t[n].type.endsWith("[]")||Array.isArray(t[n].type)&&t[n].type.length&&Array.isArray(t[n].type[0])||Object.prototype.hasOwnProperty.call(e.entities,t[n].type))))})).concat(r.id,r.revision).sort()},Helper.extendModel=function(e,t,r){if(void 0===r&&(r="_extends"),"_base"===e)return t[e];if(Object.prototype.hasOwnProperty.call(t,"_base")&&(Object.prototype.hasOwnProperty.call(t[e],r)&&t[e][r]?t[e][r]=["_base"].concat(t[e][r]):t[e][r]="_base"),Object.prototype.hasOwnProperty.call(t[e],r)){for(var n,a,o=_createForOfIteratorHelperLoose([].concat(t[e][r]));!(n=o()).done;)a=n.value,t[e]=clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(Helper.extendModel(a,t,r)),t[e]);delete t[e][r]}return t[e]},Helper.extendModels=function(e){for(var t,r=e.property.name.special,n={},a=0,o=Object.keys(e.entities);a<o.length;a++){if(t=o[a],!new RegExp(e.property.name.typeRegularExpressionPattern.public).test(t)&&!new RegExp(e.property.name.typeRegularExpressionPattern.private).test(t))throw new Error('Model names have to match "'+e.property.name.typeRegularExpressionPattern.public+'" or "'+e.property.name.typeRegularExpressionPattern.private+'" for private one (given name: "'+t+'").');n[t]=Helper.extendModel(t,e.entities,r.extend)}for(var c,i=0,s=Object.values(n);i<s.length;i++){c=s[i];for(var l=0,u=Object.entries(c);l<u.length;l++){var p=u[l],_=p[0],d=p[1];if(_===r.attachment)for(var m=0,f=Object.entries(d);m<f.length;m++){var b=f[m],h=b[0],y=b[1];d[h]=clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(e.property.defaultSpecification),y)}else[r.allowedRoles,r.constraint.execution,r.constraint.expression,r.extend,r.maximumAggregatedSize,r.minimumAggregatedSize,r.oldType].includes(_)||(c[_]=clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(e.property.defaultSpecification),d))}}return n},Helper.normalizeAllowedRoles=function(e){if(Array.isArray(e))return{read:e,write:e};if("object"==typeof e){for(var t,r={read:[],write:[]},n=0,a=Object.keys(r);n<a.length;n++)t=a[n],Object.prototype.hasOwnProperty.call(e,t)&&(Array.isArray(e[t])?r[t]=e[t]:r[t]=[e[t]]);return r}return{read:[e],write:[e]}},Helper;var a}(),__WEBPACK_DEFAULT_EXPORT__=Helper},function(e){!function(){"use strict";function t(){return(t=r()?Reflect.construct:function(e,t,r){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return r&&n(o,r.prototype),o}).apply(null,arguments)}function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function a(){return a=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},a.apply(this,arguments)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var i={d:function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},s={};i.r(s),i.d(s,{DatabaseHelper:function(){return l},default:function(){return u}});var l=function(){function e(){}return e.authenticate=function(e,t,r,n,a,c,i,s,l){var u;void 0===t&&(t=null),void 0===r&&(r={}),void 0===n&&(n={admins:{names:[],roles:[]},members:{names:[],roles:[]}}),void 0===c&&(c="_id"),void 0===i&&(i="-type"),void 0===s&&(s="_design/"),void 0===l&&(l=!1);var p=null!==(u=e[i])&&void 0!==u?u:t&&t[i];if(!p)return!0;var _=l?"read":"write",d={properties:{},read:["_admin","readonlyadmin"],write:["_admin"]};Object.prototype.hasOwnProperty.call(e,c)&&e[c].startsWith(s)&&d.read.push("readonlymember");var m,f="Current user doesn't own any role";if(r)if("name"in r||(r.name='"unknown"'),null!=(m=r.roles)&&m.length){if(a&&p&&Object.prototype.hasOwnProperty.call(a,p)){for(var b,h,y=a[p],v=o(["read","write"]);!(b=v()).done;)d[h=b.value]=d[h].concat(y[h]||[]);d.properties=y.properties}for(var g,O,x=d[_],P=o(r.roles);!(g=P()).done;)if(O=g.value,x.includes(O))return!0;f='Current user "'+r.name+'" owns the following roles: "'+r.roles.join('", "')+'"'}else f='Current user "'+r.name+"\" doesn't own any role";throw{unauthorized:"Only users with a least on of these roles are allowed to perform requested "+_+' action: "'+[].concat(d[_]).join('", "')+'". '+f+"."}},e.validateDocumentUpdate=function(e,r,n,c,i,s,l){void 0===s&&(s={});var u=function(e,t,r){var n;void 0===t&&(t="forbidden"),void 0===r&&(r={});for(var a=((n={})[t]=e,n.message=e,n.name=t,n),o=0,c=Object.entries(r);o<c.length;o++){var i=c[o],s=i[0],l=i[1];a[s]=l}throw a},p=new Date,_=Date.UTC(p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate(),p.getUTCHours(),p.getUTCMinutes(),p.getUTCSeconds(),p.getUTCMilliseconds())/1e3,d=!i.dateTimeFormat.startsWith("iso"),m=i.property.name.special,f=m.id,b=m.revision,h=m.type;r&&r[h]&&!e[h]&&(e[h]=r[h]);var y="",v="",g=function(){y=Object.prototype.hasOwnProperty.call(e,f)?e[f]:"",v=Object.prototype.hasOwnProperty.call(e,b)?e[b]:""};if(g(),Object.prototype.hasOwnProperty.call(c,i.property.name.validatedDocumentsCache)&&c[i.property.name.validatedDocumentsCache].has(y+"-"+v))return c[i.property.name.validatedDocumentsCache].delete(y+"-"+v),e;["latest","upsert"].includes(v)&&(r&&Object.prototype.hasOwnProperty.call(r,b)?v=e[b]=r[b]:"latest"===v?u("Revision: No old document available to update."):delete e[b]);var O=i.updateStrategy;Object.prototype.hasOwnProperty.call(e,m.strategy)&&(O=e[m.strategy],delete e[m.strategy]);var x,P={};if("migrate"===O)for(var w=0,E=Object.entries(s);w<E.length;w++){var k=E[w],D=k[0],j=k[1];if(Object.prototype.hasOwnProperty.call(j,m.oldType)&&![null,void 0].includes(j[m.oldType]))for(var M,A,C=o([].concat(j[m.oldType]));!(M=C()).done;)A=M.value,P[A]=D}l?x=l:JSON&&Object.prototype.hasOwnProperty.call(JSON,"stringify")?x=function(e){return JSON.stringify(e,null,4)}:u('Needed "serializer" is not available.');var T=function(e){return e instanceof Error?""+e:x(e)},R=function(e){return"string"==typeof e?e.trim():""},I=function(e){if(d)null!==e&&"number"!=typeof e&&(e=new Date(e),e=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())/1e3);else if(null!==e){e=new Date("number"!=typeof e||isNaN(e)?e:1e3*e);try{e=e.toISOString()}catch(e){}}return e},S=function(e,t,r){if(r.fileName){if(r.fileName.value)return r.fileName.value===t;if(r.fileName.regularExpressionPattern)return new RegExp(r.fileName.regularExpressionPattern).test(t)}return e===t},U=function(t,r){if(r||(r=e[m.attachment]),t){for(var n,a=0,o=Object.keys(r);a<o.length;a++)if((n=o[a]).startsWith(t))return n}else{var c=Object.keys(r);if(c.length)return c[0]}return null},L=function(e,r,n){void 0===r&&(r=!1),void 0===n&&(n={});var o=R(e);if(o){var c,i=(r?"return ":"")+o,s=a({},W,{code:i},n),l=Object.keys(s);try{c=t(Function,l.concat([i]))}catch(e){u(T(e),"compilation",{code:i,error:e,scope:s})}var p={code:i,result:void 0,scope:s};try{p.result=c.apply(void 0,l.map((function(e){return s[e]})))}catch(e){u(T(e),"runtime",{code:i,error:e,scope:s})}return p}u("No expression to evaluate provided.","empty")},N=function(e,r,n){void 0===n&&(n=[]);var a=n.length?" in "+n.join(" -> "):"",c=[],l=function(){Object.prototype.hasOwnProperty.call(e,h)||(r&&Object.prototype.hasOwnProperty.call(r,h)&&["fillUp","migrate"].includes(O)?e[h]=r[h]:u('Type: You have to specify a model type via property "'+h+'"'+a+".")),n.length||new RegExp(i.property.name.typeRegularExpressionPattern.public).test(e[h])||u('TypeName: You have to specify a model type which matches "'+i.property.name.typeRegularExpressionPattern.public+'" as public type (given "'+e[h]+'")'+a+"."),Object.prototype.hasOwnProperty.call(s,e[h])||(Object.prototype.hasOwnProperty.call(P,e[h])?e[h]=P[e[h]]:u('Model: Given model "'+e[h]+'" is not specified'+a+"."))};l();var p=e[h],_=s[p],y=null;Object.prototype.hasOwnProperty.call(_,m.additional)&&_[m.additional]&&(y=_[m.additional]);var v=function c(i,s,l,d,m){void 0===m&&(m=["constraintExecution","constraintExpression"]);for(var f,b,h=o(m);!(f=h()).done;)if(b=f.value,Object.prototype.hasOwnProperty.call(l,b)){var y,v=void 0;try{v=L(l[b].evaluation,b.endsWith("Expression"),{checkPropertyContent:c,model:_,modelName:p,name:s,type:b,newDocument:e,newValue:i,oldDocument:r,oldValue:d,parentNames:n,pathDescription:a,propertySpecification:l})}catch(i){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(i)&&u('Compilation: Hook "'+b+'" has invalid code "'+i.code+'": "'+i.message+'"'+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(i)&&u('Runtime: Hook "'+b+'" has throw an error with code "'+i.code+'": "'+i.message+'"'+a+"."),!Object.prototype.hasOwnProperty.call(i,"empty"))throw i}if(null==(y=v)||!y.result){var g=R(l[b].description);u(b.charAt(0).toUpperCase()+(b.substring(1)+": ")+(g?t(Function,Object.keys(v.scope).concat(["return "+g])).apply(void 0,Object.values(v.scope)):'Property "'+s+'" should satisfy constraint "'+v.code+'" (given "'+T(i)+'")'+a+"."))}}},x=function(e,t,r,c){void 0===c&&(c=null);var i=[],l=[].concat(r.type?r.type:[]);"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&!Object.prototype.hasOwnProperty.call(e,h)&&1===l.length&&Object.prototype.hasOwnProperty.call(s,l[0])&&(e[h]=l[0]);for(var p,_,m=!1,b=o(l);!(p=b()).done;)if(_=p.value,Object.prototype.hasOwnProperty.call(s,_)){if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,h)&&e[h]!==_&&"migrate"===O&&1===l.length&&(e[h]=_,i=n.concat(t,"migrate nested object type")),"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Object.prototype.hasOwnProperty.call(e,h)&&e[h]===_){var y=N(e,c,n.concat(t));if(y.changedPath.length&&(i=y.changedPath),e=y.newDocument,T(e)===T({}))return{newValue:null,changedPath:i};m=!0;break}1===l.length&&u('NestedType: Under key "'+t+'" isn\'t of type "'+_+'" (given "'+T(e)+'" of type '+typeof e+")"+a+".")}else if("DateTime"===_){var g=e;if(e=I(e),!(d&&("number"!=typeof e||isNaN(e))||!d&&"string"!=typeof e)){m=!0;break}1===l.length&&u('PropertyType: Property "'+t+'" isn\'t of (valid) type "DateTime" (given "'+T(g).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof g+'")'+a+".")}else if(["boolean","integer","number","string"].includes(_)){if(!("number"==typeof e&&isNaN(e)||"integer"!==_&&typeof e!==_||"integer"===_&&parseInt(e,10)!==e)){m=!0;break}1===l.length&&u('PropertyType: Property "'+t+'" isn\'t of (valid) type "${type}" (given "'+T(e)+'" of type "'+typeof e+'")'+a+".")}else if("string"==typeof _&&_.startsWith("foreignKey:")){var x=s[_.substring(11)][f].type;if(x===typeof e){m=!0;break}1===l.length&&u('PropertyType: Foreign key property "'+t+'" isn\'t of type "'+x+'" (given "'+T(e)+'" of type "'+typeof e+'")'+a+".")}else{if("any"===_||T(e)===T(_)){m=!0;break}1===l.length&&u('PropertyType: Property "'+t+'" isn\'t value "'+_+'" (given "'+T(e).replace(/^"/,"").replace(/"$/,"")+'" of type "'+typeof e+'")'+a+".")}if(m||u('PropertyType: None of the specified types "'+l.join('", "')+'" for property "'+t+'" matches value "'+T(e).replace(/^"/,"").replace(/"$/,"")+e+'" of type "'+typeof e+'")'+a+"."),"string"==typeof e&&(![null,void 0].includes(r.minimumLength)&&e.length<r.minimumLength&&u('MinimalLength: Property "'+t+'" must have minimal length '+r.minimumLength+" (given "+e+" with length i"+e.length+") "+a+"."),![null,void 0].includes(r.maximumLength)&&e.length>r.maximumLength&&u('MaximalLength: Property "'+t+'" must have maximal length '+r.maximumLength+" (given "+e+" with length "+e.length+")"+a+".")),"number"==typeof e&&(![null,void 0].includes(r.minimum)&&e<r.minimum&&u('Minimum: Property "'+t+'" (type '+r.type+") must satisfy a minimum of "+r.minimum+" (given "+e+" is too low)"+a+"."),![null,void 0].includes(r.maximum)&&e>r.maximum&&u('Maximum: Property "'+t+'" (type '+r.type+") must satisfy a maximum of "+r.maximum+" (given "+e+" is too high)"+a+".")),r.selection){var P=Array.isArray(r.selection)?r.selection.map((function(e){return void 0===(null==e?void 0:e.value)?e:e.value})):Object.keys(r.selection);"DateTime"===r.type&&(P=P.map(I)),P.includes(e)||u('Selection: Property "'+t+'" (type '+r.type+') should be one of "'+P.join('", "')+'". But is "'+e+'"'+a+".")}return[null,void 0].includes(r.regularExpressionPattern)||new RegExp(r.regularExpressionPattern).test(e)?![null,void 0].includes(r.invertedRegularExpressionPattern)&&new RegExp(r.invertedRegularExpressionPattern).test(e)&&u('InvertedPatternMatch: Property "'+t+'" should not match regular expression pattern '+r.invertedRegularExpressionPattern+' (given "'+e+'")'+a+"."):u('PatternMatch: Property "'+t+'" should match regular expression pattern '+r.regularExpressionPattern+' (given "'+e+'")'+a+"."),v(e,t,r,c),T(e)!==T(c)&&(i=n.concat(t,"value updated")),{newValue:e,changedPath:i}},w=function(e,t,r,a,o){var i=t[a];if(!e.writable)if(r){if(Object.prototype.hasOwnProperty.call(r,a)&&T(i)===T(r[a]))return a!==f&&"incremental"===O&&delete t[a],!0;u('Readonly: Property "'+a+'" is not writable (old document "'+T(r)+'")'+o+".")}else u('Readonly: Property "'+a+'" is not writable'+o+".");if(!e.mutable&&r&&Object.prototype.hasOwnProperty.call(r,a)){if(T(i)===T(r[a]))return"incremental"!==O||e.property.name.reserved.concat(m.deleted,f,b).includes(a)||delete t[a],!0;"migrate"!==O&&u('Immutable: Property "'+a+'" is not writable (old document "'+T(r)+'")'+o+".")}if(null===i){if(e.nullable)return delete t[a],r&&Object.prototype.hasOwnProperty.call(r,a)&&(c=n.concat(a,"delete property")),!0;u('NotNull: Property "'+a+'" should not be "null"'+o+".")}return!1},E=function(e,t,r,c){if(!r)for(var i,s,l=o(["onCreateExecution","onCreateExpression"]);!(i=l()).done;)if(s=i.value,Object.prototype.hasOwnProperty.call(e,s)){var d=void 0;try{d=L(e[s],s.endsWith("Expression"),{checkPropertyContent:x,model:_,modelName:p,name:c,type:s,newDocument:t,oldDocument:r,newValue:void 0,oldValue:void 0,parentNames:n,pathDescription:a,propertySpecification:e})}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&u('Compilation: Hook "'+s+'" has invalid code "'+e.code+'" for property "'+c+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&u('Runtime: Hook "'+s+'" has throw an error with code "'+e.code+'" for property "'+c+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}d&&![null,void 0].includes(d.result)&&(t[c]=d.result)}},k=function(e,t,r,c){if(Object.prototype.hasOwnProperty.call(t,c)){e.trim&&"string"==typeof t[c]&&(t[c]=t[c].trim()),e.emptyEqualsToNull&&(""===t[c]||Array.isArray(t[c])&&0===t[c].length||null!==t[c]&&"object"==typeof t[c]&&0===Object.keys(t).length)&&(t[c]=null);for(var i,s,l=o(["onUpdateExecution","onUpdateExpression"]);!(i=l()).done;)if(s=i.value,Object.prototype.hasOwnProperty.call(e,s))try{t[c]=L(e[s],s.endsWith("Expression"),{checkPropertyContent:x,model:_,modelName:p,name:c,type:s,newDocument:t,oldDocument:r,newValue:t[c],oldValue:r&&r[c],parentNames:n,pathDescription:a,propertySpecification:e}).result}catch(e){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(e)&&u('Compilation: Hook "'+s+'" has invalid code "'+e.code+'" for property "'+c+'": '+e.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(e)&&u('Runtime: Hook "'+s+'" has throw an error with code "'+e.code+'" for property "'+c+'": '+e.message+a+"."),!Object.prototype.hasOwnProperty.call(e,"empty"))throw e}}},D=Object.keys(_).filter((function(e){return![m.additional,m.allowedRoles,m.constraint.execution,m.constraint.expression,m.create.execution,m.create.expression,m.extend,m.maximumAggregatedSize,m.minimumAggregatedSize,m.oldType,m.update.execution,m.update.expression].includes(e)}));if("migrate"===O)for(var j,M,A=o(D);!(j=A()).done;)if(M=j.value,![null,void 0].includes(_[M].oldName))for(var C,U,W=o([].concat(_[M].oldName));!(C=W()).done;)U=C.value,Object.prototype.hasOwnProperty.call(e,U)&&(e[M]=e[U],delete e[U]);if(!r)for(var B,K=0,q=[m.create.execution,m.create.expression];K<q.length;K++)if(B=q[K],Object.prototype.hasOwnProperty.call(_,B)){var z=void 0;try{z=L(_[B],B.endsWith("Expression"),{checkPropertyContent:x,model:_,modelName:p,type:B,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a}).result}catch(l){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(l)&&u('Compilation: Hook "'+B+'" has invalid code "'+l.code+'" for document "'+p+'": '+l.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(l)&&u('Runtime: Hook "'+B+'" has throw an error with code "'+l.code+'" for document "'+p+'": '+l.message+a+"."),!Object.prototype.hasOwnProperty.call(l,"empty"))throw l}[null,void 0].includes(z)||(e=z),l(),p=e[h],0===n.length&&g()}for(var H,F=0,G=[m.update.execution,m.update.expression];F<G.length;F++)if(H=G[F],Object.prototype.hasOwnProperty.call(_,H)){var V=void 0;try{V=L(_[H],H.endsWith("Expression"),{checkPropertyContent:x,model:_,modelName:p,type:H,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a}).result}catch(l){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(l)&&u('Compilation: Hook "'+H+'" has invalid code "'+l.code+'" for document "'+p+'": '+l.message+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(l)&&u('Runtime: Hook "'+H+'" has throw an error with code "'+l.code+'" for document "'+p+'": '+l.message+a+"."),!Object.prototype.hasOwnProperty.call(l,"empty"))throw l}[void 0,null].includes(V)||(e=V),l(),p=e[h],0===n.length&&g()}for(var J,$=function t(){var a=J.value;if(m.attachment===a)for(var i=function(){var i=l[s],u=i[0],p=i[1];Object.prototype.hasOwnProperty.call(e,a)&&null!==e[a]||(e[a]={}),r&&!Object.prototype.hasOwnProperty.call(r,a)&&(r[a]={});var _=Object.keys(e[a]).filter((function(t){return null!==e[a][t].data&&S(u,t,p)})),d=e[a],m=[];if(r){var f=r[a];m=Object.keys(f).filter((function(e){return!(Object.prototype.hasOwnProperty.call(d,e)&&Object.prototype.hasOwnProperty.call(d[e],"data")&&null===d[e].data)&&!!f[e]&&(Object.prototype.hasOwnProperty.call(f[e],"data")&&null!==f[e].data||f[e].stub&&!!f[e].digest)&&!!S(u,e,p)}))}for(var b,h,y=p,v=o(_);!(b=v()).done;)h=b.value,E(y,d,r&&r[a]?r[a]:null,h);for(var g,x,P=o(_);!(g=P()).done;)x=g.value,k(y,d,r&&r[a]?r[a]:null,x);if([null,void 0].includes(y.default)){if(y.nullable||0<_.length||0<m.length||t(),"fillUp"===O&&0===_.length&&0<m.length)for(var w,D,j=o(m);!(w=j()).done;)D=w.value,null===d[D]?c=n.concat(a,D,"file removed"):d[D]=r[a][D]}else if(0===_.length)if(0===m.length)for(var M in y.default)Object.prototype.hasOwnProperty.call(y.default,M)&&(d[M]=y.default[M],c=n.concat(a,u,"add default file"));else if("fillUp"===O)for(var A,C,T=o(m);!(A=T()).done;)C=A.value,d[C]=r[a][C]},s=0,l=Object.entries(_[a]);s<l.length;s++)i();else{var u=D.includes(a)?_[a]:y;E(u,e,r,a),k(u,e,r,a),[null,void 0].includes(u.default)?(!(u.nullable||Object.prototype.hasOwnProperty.call(e,a)||r&&Object.prototype.hasOwnProperty.call(r,a)&&O)&&t(),!Object.prototype.hasOwnProperty.call(e,a)&&r&&Object.prototype.hasOwnProperty.call(r,a)&&("fillUp"===O?e[a]=r[a]:!O&&(c=n.concat(a,"property removed")))):(!Object.prototype.hasOwnProperty.call(e,a)||null===e[a])&&(r&&Object.prototype.hasOwnProperty.call(r,a)?"fillUp"===O?e[a]=r[a]:"migrate"===O&&(e[a]=u.default,c=n.concat(a,"migrate default value")):(e[a]=u.default,c=c.concat(a,"add default value")))}},Y=o(D.concat(y?Object.keys(e).filter((function(e){return!D.includes(e)})):[]));!(J=Y()).done;)$();if(r&&"incremental"===O)for(var X=0,Z=Object.entries(e);X<Z.length;X++){var Q=Z[X],ee=Q[0],te=Q[1];!Object.prototype.hasOwnProperty.call(r,ee)||i.property.name.reserved.concat(f,b,m.conflict,m.deleted,m.deletedConflict,m.localSequence,m.revisions,m.revisionsInformation,h).includes(ee)||r[ee]!==te&&T(r[ee])!==T(te)||delete e[ee]}for(var re=0,ne=Object.entries(e);re<ne.length;re++){var ae=ne[re],oe=ae[0],ce=ae[1];if(!i.property.name.reserved.concat(b,m.conflict,m.deleted,m.deletedConflict,m.localSequence,m.revisions,m.revisionsInformation,m.strategy).includes(oe)){var ie=void 0;if(Object.prototype.hasOwnProperty.call(_,oe))ie=_[oe];else if(y)ie=y;else{if("migrate"===O){delete e[oe],c=n.concat(oe,"migrate removed property");continue}u('Property: Given property "'+oe+'" isn\'t specified in model "'+p+'"'+a+".")}if(!ie)continue;if(m.attachment===oe){var se=ce;for(var le in se)if(Object.prototype.hasOwnProperty.call(se,le))for(var ue in _[oe])if(S(ue,le,_[oe][ue])){w(_[oe][ue],e,r,le,a);break}continue}if(w(ie,e,r,oe,a))continue;if("string"==typeof ie.type&&ie.type.endsWith("[]")||Array.isArray(ie.type)&&ie.type.length&&Array.isArray(ie.type[0])){var pe,_e=ce;Array.isArray(_e)?![null,void 0].includes(ie.minimumNumber)&&_e.length<ie.minimumNumber?u('MinimumArrayLength: Property "'+oe+'" (array of length '+_e.length+") doesn't fullfill minimum array length of "+ie.minimumNumber+a+"."):![null,void 0].includes(ie.maximumNumber)&&ie.maximumNumber<_e.length&&u('MaximumArrayLength: Property "'+oe+'" (array of length '+_e.length+") doesn't fullfill maximum array length of "+ie.maximumNumber+a+"."):u('PropertyType: Property "'+oe+'" isn\'t of type "array -> '+ie.type+'" (given "'+T(_e)+'")'+a+"."),v(_e,oe,ie,r&&Object.prototype.hasOwnProperty.call(r,oe)&&r[oe]||void 0,["arrayConstraintExecution","arrayConstraintExpression"]);var de={};for(var me in ie)Object.prototype.hasOwnProperty.call(ie,me)&&(de[me]="type"===me?Array.isArray(ie[me])?ie[me][0]:[ie[me].substring(0,ie.type.length-2)]:ie[me]);if(1===(null==(pe=de.type)?void 0:pe.length)&&Object.prototype.hasOwnProperty.call(s,de.type[0]))for(var fe,be,he=o(_e.slice());!(fe=he()).done;)"object"!=typeof(be=fe.value)||Object.getPrototypeOf(be)!==Object.prototype||Object.prototype.hasOwnProperty.call(be,h)||(be[h]=de.type[0]);for(var ye,ve,ge=0,Oe=o(_e.slice());!(ye=Oe()).done;)ve=ye.value,_e[ge]=x(ve,ge+1+". value in "+oe,de).newValue,null===ve&&_e.splice(ge,1),ge+=1;r&&Object.prototype.hasOwnProperty.call(r,oe)&&Array.isArray(r[oe])&&r[oe].length===_e.length&&T(r[oe])===T(_e)||(c=n.concat(oe,"array updated"))}else{var xe=r&&Object.prototype.hasOwnProperty.call(r,oe)?r[oe]:null,Pe=x(ce,oe,ie,xe);e[oe]=Pe.newValue,Pe.changedPath.length&&(c=Pe.changedPath),null===e[oe]&&(null!==xe&&(c=n.concat(oe,"property removed")),delete e[oe])}}}for(var we,Ee=0,ke=Object.keys(m.constraint);Ee<ke.length;Ee++)if(we=ke[Ee],(we=m.constraint[we])&&Object.prototype.hasOwnProperty.call(_,we))for(var De,je=o([].concat(_[we]));!(De=je()).done;){var Me,Ae=De.value,Ce=void 0;try{Ce=L(Ae.evaluation,we===m.constraint.expression,{checkPropertyContent:x,model:_,modelName:p,type:we,newDocument:e,oldDocument:r,parentNames:n,pathDescription:a})}catch(l){if(function(e){return Object.prototype.hasOwnProperty.call(e,"compilation")}(l)&&u('Compilation: Hook "'+we+'" has invalid code "'+l.code+'": "'+l.message+'"'+a+"."),function(e){return Object.prototype.hasOwnProperty.call(e,"runtime")}(l)&&u('Runtime: Hook "'+we+'" has thrown an error with code "'+l.code+'": '+l.message+a+"."),!Object.prototype.hasOwnProperty.call(l,"empty"))throw l}if(null==(Me=Ce)||!Me.result){var Te=we.replace(/^[^a-zA-Z]+/,"");u(Te.charAt(0).toUpperCase()+(Te.substring(1)+": ")+(Ae.description?t(Function,Object.keys(Ce.scope).concat(["return "+Ae.description.trim()])).apply(void 0,Object.values(Ce.scope)):'Model "'+p+'" should satisfy constraint "'+Ce.code+'" (given "'+T(e)+'")'+a+"."))}}if(Object.prototype.hasOwnProperty.call(e,m.attachment)){var Re=e[m.attachment];("object"!=typeof Re||Object.getPrototypeOf(Re)!==Object.prototype)&&u("AttachmentType: given attachment has invalid type"+a+".");var Ie=null;if(r&&Object.prototype.hasOwnProperty.call(r,m.attachment)&&null!==(Ie=r[m.attachment])&&"object"==typeof Ie)for(var Se=0,Ue=Object.entries(Ie);Se<Ue.length;Se++){var Le=Ue[Se],Ne=Le[0],We=Le[1];if(Object.prototype.hasOwnProperty.call(Re,Ne)){var Be=Re[Ne];null===Be||null===Be.data||Be.content_type===We.content_type&&(Be.data===We.data||Be.digest===We.digest)?((null===Be||null===Be.data)&&(c=n.concat(m.attachment,Ne,"attachment removed")),"incremental"===O&&delete Re[Ne]):c=n.concat(m.attachment,Ne,"attachment updated")}else"fillUp"===O?Re[Ne]=We:O||(c=n.concat(m.attachment,Ne,"attachment removed"))}for(var Ke=0,qe=Object.entries(Re);Ke<qe.length;Ke++){var ze=qe[Ke],He=ze[0],Fe=ze[1];[null,void 0].includes(Fe)||null===Fe.data?delete Re[He]:(!Ie||!Object.prototype.hasOwnProperty.call(Ie,He)||Fe.content_type!==Ie[He].content_type||Fe.data!==Ie[He].data&&Fe.digest!==Ie[He].digest)&&(c=n.concat(m.attachment,He,"attachment updated"))}0===Object.keys(Re).length&&delete e[m.attachment];for(var Ge={},Ve=0,Je=Object.keys(_[m.attachment]);Ve<Je.length;Ve++)Ge[Je[Ve]]=[];for(var $e=0,Ye=Object.keys(Re);$e<Ye.length;$e++){for(var Xe=Ye[$e],Ze=!1,Qe=0,et=Object.entries(_[m.attachment]);Qe<et.length;Qe++){var tt=et[Qe],rt=tt[0],nt=tt[1];if(S(rt,Xe,nt)){Ge[rt].push(Xe),Ze=!0;break}}Ze||u('AttachmentTypeMatch: None of the specified attachment types ("'+Object.keys(_[m.attachment]).join('", "')+'") matches given one ("'+Xe+'")'+a+".")}for(var at=0,ot=0,ct=Object.keys(Ge);ot<ct.length;ot++){var it=ct[ot],st=_[m.attachment][it];if(Object.prototype.hasOwnProperty.call(Ge,it)){var lt=Ge[it].length;null!==st.maximumNumber&&lt>st.maximumNumber&&u("AttachmentMaximum: given number of attachments ("+lt+") doesn't satisfy specified maximum of "+st.maximumNumber+' from type "'+it+'"'+a+"."),(!st.nullable||0!==lt)&&lt<st.minimumNumber&&u("AttachmentMinimum: given number of attachments ("+lt+") doesn't satisfy specified minimum of "+st.minimumNumber+' from type "'+it+'"'+a+".");for(var ut,pt=0,_t=o(Ge[it]);!(ut=_t()).done;){var dt,mt,ft=ut.value;null!=(dt=st.fileName)&&dt.regularExpressionPattern&&!new RegExp(st.fileName.regularExpressionPattern).test(ft)?u('AttachmentName: given attachment name "'+ft+'" doesn\'t satisfy specified regular expression pattern "'+st.fileName.regularExpressionPattern+'" from type "'+it+'"'+a+"."):null!=(mt=st.fileName)&&mt.invertedRegularExpressionPattern&&new RegExp(st.fileName.invertedRegularExpressionPattern).test(ft)?u('InvertedAttachmentName: given attachment name "'+ft+'" does satisfy specified regular expression pattern "'+st.fileName.invertedRegularExpressionPattern+'" from type "'+it+'"'+a+"."):!([null,void 0].includes(st.contentTypeRegularExpressionPattern)||Re[ft].content_type&&new RegExp(st.contentTypeRegularExpressionPattern).test(Re[ft].content_type))&&u('AttachmentContentType: given attachment content type "'+Re[ft].content_type+'" doesn\'t satisfy specified regular expression pattern "'+st.contentTypeRegularExpressionPattern+'" from type "'+it+'"'+a+".");var bt=st.invertedContentTypeRegularExpressionPattern;[null,void 0].includes(bt)||Re[ft].content_type&&!new RegExp(bt).test(Re[ft].content_type)||u('InvertedAttachmentContentType: given attachment content type "'+Re[ft].content_type+'" does satisfy specified regular expression pattern "'+bt+'" from type "'+it+'"'+a+".");var ht=0;"length"in Re[ft]?ht=Re[ft].length:"data"in Re[ft]&&(ht=Buffer&&"byteLength"in Buffer?Buffer.byteLength(Re[ft].data,"base64"):Re[ft].data.length),![null,void 0].includes(st.minimumSize)&&st.minimumSize>ht?u("AttachmentMinimumSize: given attachment size "+ht+" byte doesn't satisfy specified minimum of "+st.minimumSize+" byte "+a+"."):![null,void 0].includes(st.maximumSize)&&st.maximumSize<ht&&u("AttachmentMaximumSize: given attachment size "+ht+" byte doesn't satisfy specified maximum of "+st.maximumSize+" byte "+a+"."),pt+=ht}![null,void 0].includes(st.minimumAggregatedSize)&&st.minimumAggregatedSize>pt?u('AttachmentAggregatedMinimumSize: given aggregated size of attachments from type "'+it+'" '+pt+" byte doesn't satisfy specified minimum of "+st.minimumAggregatedSize+" byte "+a+"."):![null,void 0].includes(st.maximumAggregatedSize)&&st.maximumAggregatedSize<pt&&u('AttachmentAggregatedMaximumSize: given aggregated size of attachments from type "'+it+'" '+pt+" byte doesn't satisfy specified maximum of "+st.maximumAggregatedSize+" byte "+a+"."),at+=pt}}Object.prototype.hasOwnProperty.call(_,m.minimumAggregatedSize)&&![null,void 0].includes(_[m.minimumAggregatedSize])&&_[m.minimumAggregatedSize]>at?u("AggregatedMinimumSize: given aggregated size "+at+" byte doesn't satisfy specified minimum of "+_[m.minimumAggregatedSize]+" byte "+a+"."):![null,void 0].includes(_[m.maximumAggregatedSize])&&_[m.maximumAggregatedSize]<at&&u("AggregatedMaximumSize: given aggregated size "+at+" byte doesn't satisfy specified maximum of "+_[m.maximumAggregatedSize]+" byte "+a+".")}if(r&&Object.prototype.hasOwnProperty.call(r,m.attachment)&&0===Object.keys(r[m.attachment]).length&&delete r[m.attachment],0===c.length&&r&&"migrate"===O)for(var yt,vt=0,gt=Object.keys(r);vt<gt.length;vt++)yt=gt[vt],Object.prototype.hasOwnProperty.call(e,yt)||(c=n.concat(yt,"migrate removed property"));return{changedPath:c,newDocument:e}},W={attachmentWithPrefixExists:function(t){if(Object.prototype.hasOwnProperty.call(e,m.attachment)){var r=e[m.attachment],n=U(t);if(n)return Object.prototype.hasOwnProperty.call(r[n],"stub")&&r[n].stub||Object.prototype.hasOwnProperty.call(r[n],"data")&&![null,void 0].includes(r[n].data)}return!1},checkDocument:N,getFileNameByPrefix:U,serialize:T,id:y,revision:v,idName:f,revisionName:b,specialNames:m,typeName:h,modelConfiguration:i,models:s,now:p,nowUTCTimestamp:_,securitySettings:c,userContext:n},B=N(e,r);return(!B.newDocument._deleted||r)&&(B.newDocument._deleted&&B.newDocument._deleted!==(null==r?void 0:r._deleted)||B.changedPath.length)||u("NoChange: No new data given. new document: "+T(e)+"; old document: "+T(r)+"."),Object.prototype.hasOwnProperty.call(c,i.property.name.validatedDocumentsCache)?c[i.property.name.validatedDocumentsCache].add(y+"-"+v):c[i.property.name.validatedDocumentsCache]=new Set([y+"-"+v]),B.newDocument},e}(),u=l;e.exports=s}()}],__webpack_module_cache__={};__nested_webpack_require_12__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __nested_webpack_require_12__.d(t,{a:t}),t},__nested_webpack_require_12__.d=function(e,t){for(var r in t)__nested_webpack_require_12__.o(t,r)&&!__nested_webpack_require_12__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__nested_webpack_require_12__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__nested_webpack_require_12__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(function(){"use strict";function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}__nested_webpack_require_12__.r(__webpack_exports__),__nested_webpack_require_12__.d(__webpack_exports__,{Database:function(){return y},default:function(){return v}});var r=__nested_webpack_require_12__(1),n=__nested_webpack_require_12__.n(r),a=__nested_webpack_require_12__(2),o=__nested_webpack_require_12__.n(a),c=__nested_webpack_require_12__(4),i=__nested_webpack_require_12__.n(c),s=__nested_webpack_require_12__(6),l=__nested_webpack_require_12__(7),u=__nested_webpack_require_12__.n(l),p=__webpack_require__(11),_=__nested_webpack_require_12__.n(p),d=__webpack_require__(12),m=__nested_webpack_require_12__.n(d),f=__nested_webpack_require_12__(9),b=__nested_webpack_require_12__.n(f),h=__nested_webpack_require_12__(8),y=function(){function t(){}return t.loadService=function(){var t=n()(o().mark((function t(r,n,a){var l,p,_,d,m,f,y,v,g,O,x,P,w,E,k,D,j,M,A,C,T,R,I,S,U,L,N,W,B,K,q,z,H,F,G,V,J,$,Y,X,Z,Q,ee,te,re,ne,ae,oe,ce,ie,se,le,ue,pe,_e,de,me,fe,be,he,ye,ve,ge,Oe,xe,Pe,we,Ee,ke,De,je,Me,Ae,Ce,Te,Re,Ie,Se,Ue,Le,Ne,We,Be,Ke,qe,ze,He,Fe,Ge,Ve,Je;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=null,!Object.prototype.hasOwnProperty.call(n.couchdb.server,"runner")){t.next=8;break}return t.next=4,h.default.startServer(n,a);case 4:n.couchdb.server.restart=h.default.restartServer,n.couchdb.server.start=h.default.startServer,n.couchdb.server.stop=h.default.stopServer,l=new Promise((function(e,t){n.couchdb.server.resolve=e,n.couchdb.server.reject=t}));case 8:if(!Object.prototype.hasOwnProperty.call(n.couchdb,"connection")){t.next=10;break}return t.abrupt("return",{name:"couchdb",promise:l});case 10:if(p=i().stringFormat(a.couchdb.url,a.couchdb.user.name+":"+a.couchdb.user.password+"@"),!a.couchdb.ensureAdminPresence){t.next=42;break}return _=new n.couchdb.connector(i().stringFormat(a.couchdb.url,"")+"/_users",h.default.getConnectorOptions(a)),t.prev=13,t.next=16,_.allDocs();case 16:return t.next=19,c.globalContext.fetch(i().stringFormat(a.couchdb.url,"")+"/"+n.couchdb.server.runner.adminUserConfigurationPath+"/"+a.couchdb.user.name,{body:'"'+a.couchdb.user.password+'"',method:"PUT"});case 19:t.next=39;break;case 21:if(t.prev=21,t.t0=t.catch(13),"unauthorized"!==t.t0.name){t.next=38;break}return d=new n.couchdb.connector(p+"/_users",h.default.getConnectorOptions(a)),t.prev=25,t.next=28,d.allDocs();case 28:t.next=33;break;case 30:t.prev=30,t.t1=t.catch(25);case 33:return t.prev=33,d.close(),t.finish(33);case 36:t.next=39;break;case 38:case 39:return t.prev=39,_.close(),t.finish(39);case 42:if(!a.couchdb.ensureUserPresence){t.next=77;break}m=0,f=[a.couchdb.security.admins,a.couchdb.security.members];case 44:if(!(m<f.length)){t.next=77;break}y=f[m],v=e(y.names);case 47:if((g=v()).done){t.next=74;break}return O=g.value,x=new n.couchdb.connector(p+"/_users",h.default.getConnectorOptions(a)),t.prev=50,t.next=53,x.get("org.couchdb.user:"+O);case 53:t.next=69;break;case 55:if(t.prev=55,t.t2=t.catch(50),"not_found"!==t.t2.error){t.next=68;break}return t.prev=58,t.next=61,x.put(((P={})[a.couchdb.model.property.name.special.id]="org.couchdb.user:"+O,P.name=O,P.password=O,P.roles=[].concat(y.roles.includes(O+"s")?O+"s":[]),P.type="user",P));case 61:t.next=66;break;case 63:throw t.prev=63,t.t3=t.catch(58),new Error("Couldn't create missing user \""+O+'": '+i().represent(t.t3));case 66:t.next=69;break;case 68:throw new Error("Couldn't check for presence of user \""+O+'": '+i().represent(t.t2));case 69:return t.prev=69,x.close(),t.finish(69);case 72:t.next=47;break;case 74:m++,t.next=44;break;case 77:if(!a.couchdb.model.updateConfiguration){t.next=132;break}w=e(a.couchdb.backend.prefixes);case 79:if((E=w()).done){t.next=132;break}k=E.value,t.t4=o().keys(a.couchdb.backend.configuration);case 82:if((t.t5=t.t4()).done){t.next=130;break}if(D=t.t5.value,!Object.prototype.hasOwnProperty.call(a.couchdb.backend.configuration,D)){t.next=128;break}return j="/"+k+(k.trim()?"/":"")+D,M=""+p+j,A=a.couchdb.backend.configuration[D],C=void 0,t.prev=89,t.next=92,c.globalContext.fetch(M);case 92:C=t.sent,t.next=98;break;case 95:t.prev=95,t.t6=t.catch(89);case 98:if(!C){t.next=128;break}if(!C.ok){t.next=127;break}if(T=!0,"function"!=typeof C.text){t.next=113;break}return t.prev=102,t.t7=A,t.next=106,C["string"==typeof A?"text":"json"]();case 106:t.t8=t.sent,T=t.t7===t.t8,t.next=113;break;case 110:t.prev=110,t.t9=t.catch(102);case 113:if(!T){t.next=124;break}return t.prev=114,t.next=117,c.globalContext.fetch(M,{body:'"'+a.couchdb.backend.configuration[D]+'"',method:"PUT"});case 117:t.next=122;break;case 119:t.prev=119,t.t10=t.catch(114);case 122:t.next=125;break;case 124:case 125:t.next=128;break;case 127:case 128:t.next=82;break;case 130:t.next=79;break;case 132:return t.next=134,h.default.initializeConnection(n,a);case 134:if(R=a.couchdb.model.property.name.special.id,I=a.couchdb.model.property.name.special.type,!a.couchdb.ensureSecuritySettingsPresence){t.next=145;break}return t.prev=137,t.next=140,c.globalContext.fetch(p+"/"+a.couchdb.databaseName+"/_security",{body:JSON.stringify(a.couchdb.security),method:"PUT"});case 140:t.next=145;break;case 142:t.prev=142,t.t11=t.catch(137);case 145:if(delete(S=i().copy(a.couchdb.model)).property.defaultSpecification,delete S.entities,U=h.default.extendModels(a.couchdb.model),!a.couchdb.model.updateValidation){t.next=213;break}return t.next=152,s.promises.readFile(c.currentRequire.resolve("./databaseHelper"),{encoding:a.core.encoding,flag:"r"});case 152:L=t.sent,N=e([{description:"Model specification",methodName:"validateDocumentUpdate",name:"validation",serializedParameter:JSON.stringify(S)+", "+JSON.stringify(U)},{description:"Authorisation",methodName:"authenticate",name:"authentication",serializedParameter:JSON.stringify(h.default.determineAllowedModelRolesMapping(a.couchdb.model))+", '"+R+"', '"+I+"', '"+a.couchdb.model.property.name.special.designDocumentNamePrefix+"'"}]);case 154:if((W=N()).done){t.next=169;break}B=W.value,K="function(...parameters) {\n    return require('helper').default."+B.methodName+"(...parameters.concat(["+B.serializedParameter+"]))\n}",t.prev=157,new Function("return "+K),t.next=164;break;case 161:throw t.prev=161,t.t12=t.catch(157),new Error("Generated "+B.name+' code "'+K+"\" doesn't compile: "+i().represent(t.t12));case 164:return a.core.debug,t.next=167,h.default.ensureValidationDocumentPresence(n.couchdb.connection,B.name,{helper:L,validate_doc_update:K},B.description,!0,R,S.property.name.special.designDocumentNamePrefix);case 167:t.next=154;break;case 169:q=0,z=Object.entries(U);case 170:if(!(q<z.length)){t.next=213;break}H=z[q],F=H[0],G=H[1],V=0,J=Object.entries(G);case 173:if(!(V<J.length)){t.next=210;break}if($=J[V],Y=$[0],X=$[1],![S.property.name.special.constraint.execution,S.property.name.special.constraint.expression].includes(Y)){t.next=191;break}Z=e([].concat(X));case 177:if((Q=Z()).done){t.next=189;break}if(!(ee=Q.value).description){t.next=187;break}t.prev=180,new Function("return "+ee.description),t.next=187;break;case 184:throw t.prev=184,t.t13=t.catch(180),new Error('Specified constraint description "'+ee.description+'" for model "'+F+'" doesn\'t compile: "'+i().represent(t.t13)+'".');case 187:t.next=177;break;case 189:t.next=207;break;case 191:te=X,re=e(["conflictingConstraintExpression","conflictingConstraintExecution","constraintExpression","constraintExecution"]);case 193:if((ne=re()).done){t.next=207;break}if(ae=ne.value,null===te||"object"!=typeof te){t.next=205;break}if(null==(oe=te[ae])||!oe.description){t.next=205;break}t.prev=198,new Function(oe.description),t.next=205;break;case 202:throw t.prev=202,t.t14=t.catch(198),new Error('Specified constraint description "'+oe.description+'" for model "'+F+'" in property "'+Y+'" as "'+ae+'" doesn\'t compile: "'+i().represent(t.t14)+'".');case 205:t.next=193;break;case 207:V++,t.next=173;break;case 210:q++,t.next=170;break;case 213:if(!a.couchdb.model.autoMigrationPath){t.next=305;break}return ce={},t.next=217,i().isDirectory(u().resolve(a.couchdb.model.autoMigrationPath));case 217:if(!t.sent){t.next=257;break}return t.t15=e,t.next=221,i().walkDirectoryRecursively(u().resolve(a.couchdb.model.autoMigrationPath),a.couchdb.debug?i().noop:function(e){return"debug"!==e.name});case 221:t.t16=t.sent,ie=(0,t.t15)(t.t16);case 223:if((se=ie()).done){t.next=257;break}if(le=se.value,ue=u().extname(le.name),pe=u().basename(le.name,ue),".json"!==ue){t.next=254;break}return _e=void 0,t.prev=229,t.t17=JSON,t.next=233,s.promises.readFile(le.path,{encoding:a.core.encoding,flag:"r"});case 233:t.t18=t.sent,_e=t.t17.parse.call(t.t17,t.t18),t.next=240;break;case 237:throw t.prev=237,t.t19=t.catch(229),new Error('Parsing document "'+le.path+'" to include by automigration of has failed: '+i().represent(t.t19));case 240:return _e[R]=pe,_e[a.couchdb.model.property.name.special.revision]="upsert",t.prev=242,t.next=245,n.couchdb.connection.put(_e);case 245:t.next=251;break;case 247:throw t.prev=247,t.t20=t.catch(242),null!=(de=t.t20.forbidden)&&de.startsWith("NoChange:"),new Error('Migrating document "'+_e[R]+'" of type "'+_e[I]+'" has failed: '+i().represent(t.t20));case 251:t.next=255;break;case 254:".js"===u().extname(le.name)&&(ce[le.path]=(0,c.currentRequire)(le.path).default);case 255:t.next=223;break;case 257:return t.t21=e,t.next=260,n.couchdb.connection.allDocs({include_docs:!0});case 260:t.t22=t.sent.rows,me=(0,t.t21)(t.t22);case 262:if((fe=me()).done){t.next=305;break}if("string"==typeof(be=fe.value).id&&be.id.startsWith(a.couchdb.model.property.name.special.designDocumentNamePrefix)){t.next=303;break}he=be.doc,(ye=i().copy(he))[a.couchdb.model.property.name.special.strategy]="migrate",ve=e(Object.keys(ce).sort());case 269:if((ge=ve()).done){t.next=282;break}Oe=ge.value,xe=null,t.prev=272,xe=ce[Oe](ye,{configuration:a,databaseHelper:b(),idName:R,migrater:ce,models:U,modelConfiguration:S,selfFilePath:Oe,services:n,tools:i(),typeName:I}),t.next=279;break;case 276:throw t.prev=276,t.t23=t.catch(272),new Error('Running migrater "'+Oe+'" in document '+h.default.mayStripRepresentation(he,a.couchdb.maximumRepresentationTryLength,a.couchdb.maximumRepresentationLength)+'" failed: '+i().represent(t.t23));case 279:xe&&(ye=xe);case 280:t.next=269;break;case 282:t.prev=282,b().validateDocumentUpdate(i().copy(ye),i().copy(he),{db:a.couchdb.databaseName,name:a.couchdb.user.name,roles:["_admin"]},i().copy(a.couchdb.security),S,U),t.next=294;break;case 286:if(t.prev=286,t.t24=t.catch(282),!Object.prototype.hasOwnProperty.call(t.t24,"forbidden")){t.next=293;break}return t.t24.forbidden.startsWith("NoChange:"),t.abrupt("continue",303);case 293:throw t.t24;case 294:return t.prev=294,t.next=297,n.couchdb.connection.put(ye);case 297:t.next=302;break;case 299:throw t.prev=299,t.t25=t.catch(294),new Error('Replaceing auto migrated document "'+ye[R]+'" has failed: '+i().represent(t.t25));case 302:case 303:t.next=262;break;case 305:if(!a.couchdb.createGenericFlatIndex||!a.couchdb.model.autoMigrationPath){t.next=360;break}return t.next=308,n.couchdb.connection.getIndexes();case 308:Pe=t.sent.indexes,we=0,Ee=Object.entries(U);case 310:if(!(we<Ee.length)){t.next=341;break}if(ke=Ee[we],De=ke[0],je=ke[1],!new RegExp(a.couchdb.model.property.name.typeRegularExpressionPattern.public).test(De)){t.next=338;break}return t.next=315,n.couchdb.connection.createIndex({index:{ddoc:De+"-GenericIndex",fields:[I],name:De+"-GenericIndex"}});case 315:Me=e(h.default.determineGenericIndexablePropertyNames(a.couchdb.model,je));case 316:if((Ae=Me()).done){t.next=338;break}Ce=Ae.value,Te=De+"-"+Ce+"-GenericIndex",Re=-1,Ie=0,Se=e(Pe);case 322:if((Ue=Se()).done){t.next=330;break}if(Ue.value.name!==Te){t.next=327;break}return Re=Ie,t.abrupt("break",330);case 327:Ie+=1;case 328:t.next=322;break;case 330:if(-1!==Re){t.next=335;break}return t.next=333,n.couchdb.connection.createIndex({index:{ddoc:Te,fields:[I,Ce],name:Te}});case 333:t.next=336;break;case 335:Pe.slice(Ie,1);case 336:t.next=316;break;case 338:we++,t.next=310;break;case 341:Le=e(Pe);case 342:if((Ne=Le()).done){t.next=360;break}if(!(We=Ne.value).name.endsWith("-GenericIndex")){t.next=358;break}Be=!1,Ke=0,qe=Object.entries(U);case 347:if(!(Ke<qe.length)){t.next=355;break}if(ze=qe[Ke],He=ze[0],Fe=ze[1],!We.name.startsWith(He+"-")){t.next=352;break}for(Ge=e(h.default.determineGenericIndexablePropertyNames(a.couchdb.model,Fe));!(Ve=Ge()).done;)Je=Ve.value,[He+"-"+Je+"-GenericIndex",He+"-GenericIndex"].includes(We.name)&&(Be=!0);return t.abrupt("break",355);case 352:Ke++,t.next=347;break;case 355:if(Be){t.next=358;break}return t.next=358,n.couchdb.connection.deleteIndex(We);case 358:t.next=342;break;case 360:if(!a.couchdb.model.triggerInitialCompaction){t.next=369;break}return t.prev=361,t.next=364,n.couchdb.connection.compact();case 364:t.next=369;break;case 366:t.prev=366,t.t26=t.catch(361);case 369:return t.abrupt("return",{name:"couchdb",promise:l});case 370:case"end":return t.stop()}}),t,null,[[13,21,39,42],[25,30,33,36],[50,55,69,72],[58,63],[89,95],[102,110],[114,119],[137,142],[157,161],[180,184],[198,202],[229,237],[242,247],[272,276],[282,286],[294,299],[361,366]])})));return function(){return t.apply(this,arguments)}}(),t.postLoadService=function(e,r,a,c,s){var l=0;setInterval((function(){0<l&&(l=0)}),3e4);var u=i().debounce(n()(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.changesStream&&t.changesStream.cancel(),t.changesStream=r.couchdb.connection.changes(i().extend(!0,i().copy(a.couchdb.changesStream),t.additionalChangesStreamOptions)),t.changesStream.on("error",n()(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(l+=1))){e.next=9;break}return l=0,t.changesStream.cancel(),e.next=7,r.couchdb.server.restart(r,a,c,s);case 7:e.next=10;break;case 9:case 10:u();case 11:case"end":return e.stop()}}),e)})))),e.next=5,s.callStack("couchdbInitializeChangesStream",c,a,t.changesStream,r);case 5:case"end":return e.stop()}}),e)}))));return a.couchdb.attachAutoRestarter&&u(),e},t.preLoadService=function(){var r=n()(o().mark((function r(a,c){var s,l,p,d,f,b,h,y,v,g,O,x,P,w;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Object.prototype.hasOwnProperty.call(a,"couchdb")||(a.couchdb={}),Object.prototype.hasOwnProperty.call(a.couchdb,"connector")||(s=c.couchdb.model.property.name.special.id,l=c.couchdb.model.property.name.special.revision,a.couchdb.connector=_(),p=a.couchdb.connector.prototype.bulkDocs.bind(a.couchdb.connection),a.couchdb.connector.plugin({bulkDocs:function(){var r=n()(o().mark((function r(n){var a,i,u,_,d,m,f,b,h,y,v,g,O,x,P,w,E,k,D=arguments;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(i=D.length,u=Array(1<i?i-1:0),_=1;_<i;_++)u[_-1]=D[_];return d=0<u.length&&u[u.length-1]===t.toggleIDDetermining,m=d?!t.skipIDDetermining:t.skipIDDetermining,d&&u.pop(),f=!Array.isArray(n)&&null!==n&&"object"==typeof n&&s in n?[n]:n,null!=(a=c.couchdb.connector.fetch)&&a.timeout&&(0===u.length||"object"!=typeof u[0])&&u.unshift({timeout:c.couchdb.connector.fetch.timeout}),r.next=8,p.call.apply(p,[this,f].concat(u));case 8:b=r.sent,h=[],y=[],v=0,g=e(b);case 13:if((O=g()).done){r.next=36;break}if(x=O.value,"object"!=typeof f[v]){r.next=33;break}if(!(l in f[v])||"conflict"!==x.name||!["latest","upsert"].includes(f[v][l])){r.next=21;break}y.push(f[v]),h.push(v),r.next=33;break;case 21:if(!(s in f[v]&&c.couchdb.ignoreNoChangeError&&"name"in x&&"forbidden"===x.name&&"message"in x&&x.message.startsWith("NoChange:"))){r.next=33;break}if(b[v]={id:f[v][s],ok:!0},m){r.next=33;break}if(!(l in f[v])||["latest","upsert"].includes(f[v][l])){r.next=28;break}r.t0=f[v][l],r.next=32;break;case 28:return r.next=30,this.get(b[v].id);case 30:r.t1=l,r.t0=r.sent[r.t1];case 32:b[v].rev=r.t0;case 33:v+=1;case 34:r.next=13;break;case 36:if(!y.length){r.next=43;break}return f=y,d&&u.push(t.toggleIDDetermining),r.next=41,this.bulkDocs.apply(this,[f].concat(u));case 41:for(P=r.sent,w=e(P);!(E=w()).done;)k=E.value,b[h.shift()]=k;case 43:return r.abrupt("return",b);case 44:case"end":return r.stop()}}),r,this)})));return function(){return r.apply(this,arguments)}}()}),c.couchdb.debug&&a.couchdb.connector.debug.enable("*"),a.couchdb.connector=a.couchdb.connector.plugin(m())),Object.prototype.hasOwnProperty.call(a.couchdb,"server")){r.next=34;break}a.couchdb.server={},d=[],f=e([].concat(c.couchdb.binary.runner));case 6:if((b=f()).done){r.next=32;break}h=b.value,y=e([].concat(h.location));case 9:if((v=y()).done){r.next=28;break}g=v.value,O=e([].concat(h.name));case 12:if((x=O()).done){r.next=24;break}return P=x.value,w=u().resolve(g,P),d.push(w),r.next=18,i().isFile(w);case 18:if(!r.sent){r.next=22;break}return h.binaryFilePath=w,a.couchdb.server.runner=h,r.abrupt("break",24);case 22:r.next=12;break;case 24:if(!Object.prototype.hasOwnProperty.call(a.couchdb.server,"runner")){r.next=26;break}return r.abrupt("break",28);case 26:r.next=9;break;case 28:if(!Object.prototype.hasOwnProperty.call(a.couchdb.server,"runner")){r.next=30;break}return r.abrupt("break",32);case 30:r.next=6;break;case 32:if(Object.prototype.hasOwnProperty.call(a.couchdb.server,"runner")){r.next=34;break}throw new Error('No binary file in one of the following locations found: "'+d.join('", "')+'".');case 34:return r.abrupt("return",a);case 35:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),t.shouldExit=function(){var e=n()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.stopServer(t,r);case 2:return delete t.couchdb,n="log.txt",e.next=6,i().isFile(n);case 6:if(!e.sent){e.next=9;break}return e.next=9,s.promises.unlink(n);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t}();y.additionalChangesStreamOptions={},y.changesStream=void 0,y.skipIDDetermining=!0,y.toggleIDDetermining=Symbol("toggleIDDetermining");var v=y})(),module.exports=__webpack_exports__})()},,e=>{"use strict";e.exports=require("pouchdb")},e=>{"use strict";e.exports=require("pouchdb-find")}],__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__=__webpack_require__(9);module.exports=__webpack_exports__})();